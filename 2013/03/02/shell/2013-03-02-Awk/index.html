<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>文本处理神器sed与awk命令使用(续) | Kenshin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="上一篇传送门
概述：awk功能与sed相似，都是处理文本的工具，但是awk的强大之处在于借助强大的语法支持处理格式化的文本，在处理没有规律的文本上面不及sed方便，术业有专攻吧。
awk编程模型:awk不能看作是一个shell命令了，更应该是一门编程语言。awk程序由一个主输入循环维持，其反复执行直到终止条件被触发。幸运的是awk的主循环框架无需我们去编写，已经搭建好了，我们只需要将写好的代码嵌入">
<meta property="og:type" content="article">
<meta property="og:title" content="文本处理神器sed与awk命令使用(续)">
<meta property="og:url" content="http://yoursite.com/2013/03/02/shell/2013-03-02-Awk/index.html">
<meta property="og:site_name" content="Kenshin">
<meta property="og:description" content="上一篇传送门
概述：awk功能与sed相似，都是处理文本的工具，但是awk的强大之处在于借助强大的语法支持处理格式化的文本，在处理没有规律的文本上面不及sed方便，术业有专攻吧。
awk编程模型:awk不能看作是一个shell命令了，更应该是一门编程语言。awk程序由一个主输入循环维持，其反复执行直到终止条件被触发。幸运的是awk的主循环框架无需我们去编写，已经搭建好了，我们只需要将写好的代码嵌入">
<meta property="og:updated_time" content="2016-01-04T12:16:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="文本处理神器sed与awk命令使用(续)">
<meta name="twitter:description" content="上一篇传送门
概述：awk功能与sed相似，都是处理文本的工具，但是awk的强大之处在于借助强大的语法支持处理格式化的文本，在处理没有规律的文本上面不及sed方便，术业有专攻吧。
awk编程模型:awk不能看作是一个shell命令了，更应该是一门编程语言。awk程序由一个主输入循环维持，其反复执行直到终止条件被触发。幸运的是awk的主循环框架无需我们去编写，已经搭建好了，我们只需要将写好的代码嵌入">
  
    <link rel="alternative" href="/atom.xml" title="Kenshin" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/author.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Kenshin</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="GitHub" target="_blank" href="https://github.com/gayyzxyx" title="GitHub">GitHub</a>
					        
								<a class="Email" target="_blank" href="/yao.rid@gmail.com" title="Email">Email</a>
					        
								<a class="LinkedIn" target="_blank" href="https://www.linkedin.com/in/xin-yao-713b2b78" title="LinkedIn">LinkedIn</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BIO/" style="font-size: 10px;">BIO</a> <a href="/tags/ConcurrentModificationException/" style="font-size: 10px;">ConcurrentModificationException</a> <a href="/tags/Netty/" style="font-size: 10px;">Netty</a> <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/awk/" style="font-size: 12.5px;">awk</a> <a href="/tags/bottle/" style="font-size: 10px;">bottle</a> <a href="/tags/crack/" style="font-size: 10px;">crack</a> <a href="/tags/date/" style="font-size: 10px;">date</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/java/" style="font-size: 17.5px;">java</a> <a href="/tags/maketrans/" style="font-size: 10px;">maketrans</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/pptp/" style="font-size: 10px;">pptp</a> <a href="/tags/putty/" style="font-size: 10px;">putty</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/reflection/" style="font-size: 10px;">reflection</a> <a href="/tags/sed/" style="font-size: 12.5px;">sed</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/shell/" style="font-size: 20px;">shell</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/sublime-text2/" style="font-size: 10px;">sublime text2</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/translate/" style="font-size: 10px;">translate</a> <a href="/tags/vpn/" style="font-size: 10px;">vpn</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Kenshin</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/author.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Kenshin</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="GitHub" target="_blank" href="https://github.com/gayyzxyx" title="GitHub">GitHub</a>
			        
						<a class="Email" target="_blank" href="/yao.rid@gmail.com" title="Email">Email</a>
			        
						<a class="LinkedIn" target="_blank" href="https://www.linkedin.com/in/xin-yao-713b2b78" title="LinkedIn">LinkedIn</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-shell/2013-03-02-Awk" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/03/02/shell/2013-03-02-Awk/" class="article-date">
  	<time datetime="2013-03-01T16:00:00.000Z" itemprop="datePublished">2013-03-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      文本处理神器sed与awk命令使用(续)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/awk/">awk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sed/">sed</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>上一篇<a href="http://gayyzxyx.github.com/shell/2013/02/24/Sed-And-Awk/" target="_blank" rel="external">传送门</a></p>
<h2 id="u6982_u8FF0_uFF1A"><a href="#u6982_u8FF0_uFF1A" class="headerlink" title="概述："></a>概述：</h2><p>awk功能与sed相似，都是处理文本的工具，但是awk的强大之处在于借助强大的语法支持处理格式化的文本，在处理没有规律的文本上面不及sed方便，术业有专攻吧。</p>
<h2 id="awk_u7F16_u7A0B_u6A21_u578B_3A"><a href="#awk_u7F16_u7A0B_u6A21_u578B_3A" class="headerlink" title="awk编程模型:"></a>awk编程模型:</h2><p>awk不能看作是一个shell命令了，更应该是一门编程语言。awk程序由一个主输入循环维持，其反复执行直到终止条件被触发。幸运的是awk的主循环框架无需我们去编写，已经搭建好了，我们只需要将写好的代码嵌入到循环框架中执行。awk有两个特殊的字段：BEGIN和END，BEGIN在主输入循环之前执行，即在未读取输入文件之前执行，END则恰好相反。总体看，awk程序的执行分为三个阶段：读输入文件之前的执行代码段（由BEGIN关键字标识）、读取输入文件时的执行代码段、读取输入文件之后的执行代码段（由END关键字标志）。</p>
<h2 id="awk_u7684_u8C03_u7528_u65B9_u6CD5_uFF1A"><a href="#awk_u7684_u8C03_u7528_u65B9_u6CD5_uFF1A" class="headerlink" title="awk的调用方法："></a>awk的调用方法：</h2><p>调用awk的方法与调用sed类似，也有三种方式：</p>
<p>1.在shell命令行输入命令调用awk，格式为    </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [-F 域分隔符] <span class="string">'awk程序段'</span> 输入文件   <span class="comment">#需要用单引号将awk程序段引起来</span></span><br></pre></td></tr></table></figure>

2\.将awk程序段插入脚本文件，然后通过awk命令调用它，格式为

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="operator">-f</span> awk脚本文件 输入文件     <span class="comment">#同sed命令类似也是通过-f选项表示调用脚本文件</span></span><br></pre></td></tr></table></figure>
<p>3.将sed命令插入脚本文件之后，最常用的方法是设置改脚本可执行，然后直接直接执行该脚本文件，格式为</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./awk脚本文件 输入文件     <span class="comment">#同样以#/awk路径来开头</span></span><br></pre></td></tr></table></figure>

### 1\.awk模式匹配

任何awk语句都是由模式(pattern)和动作(action)构成，模式测试输入行是否需要执行动作的规则(决定动作何时触发和触发事件)，动作是包含语句、函数和表达式的执行过程(执行对输入行的处理)，awk不仅支持所有正则表达式的元字符还支持"?"和"+"两个扩展元字符，而grep和sed并不支持，看awk的三种调用方法。

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk '/^$/&#123;print "this is a blank line."&#125;' input    #方法一调用awk打印空白行</span></span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># cat &amp;gt; scr.awk   #创建scr.awk，执行命令</span></span><br><span class="line">/^$/&#123;<span class="built_in">print</span> <span class="string">"this is a blank line."</span>&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># awk -f scr.awk input   #方法二调用awk打印空白行</span></span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># cat  scr1.awk      #创建脚本</span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">/^$/&#123;<span class="built_in">print</span> <span class="string">"this is a blank line."</span>&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># chmod u+x scr1.awk    #赋予可执行权限</span></span><br><span class="line">root@core /home/awk<span class="comment"># ./scr1.awk input     #方法三调用awk打印空白行</span></span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br></pre></td></tr></table></figure>
<h3 id="2-_u8BB0_u5F55_u548C_u57DF"><a href="#2-_u8BB0_u5F55_u548C_u57DF" class="headerlink" title="2.记录和域"></a>2.记录和域</h3><p>awk认为输入文件是结构化的，将每个输入行定义为记录，行中每一个字符串定义为域，域之间用空格、tab键或者其他符号进行分割。awk定义$来指定执行动作的域，如$1表示第一个域，$2表示第二个，$0则表示所有的域。有一个stu记录了学生信息，有四个域，分别用空格、tab、tab隔开如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk '&#123;print $2,$1,$3,$4&#125;' stu   #依次打印第二个。第一个、第三个、第四个域</span></span><br><span class="line">Hao Li njue <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Ju Zhang nju <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">B<span class="keyword">in</span> Wang seu <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">L<span class="keyword">in</span> Zhu njupt <span class="number">025</span>-<span class="number">83680010</span></span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># awk '&#123;print $0&#125;' stu         #$0表示打印所有域</span></span><br><span class="line">Li Hao  njue    <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju        nju     <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>        seu     <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span> njupt   <span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>域操作符后面可以跟变量或者运算表达式，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;one=1;two=2&#125;&#123;print $(one+two)&#125;' stu   #打印第三个域</span></span><br><span class="line">njue</span><br><span class="line">nju</span><br><span class="line">seu</span><br><span class="line">njupt</span><br></pre></td></tr></table></figure>
<p>可以用awk的<code>-F</code>选项来改变分隔符，awk的默认设置的分隔符是空格键，而tab键是被当做连续的空格符来处理。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk -F"\t" '&#123;print $3&#125;' stu    #此时的第三个域则是电话号码那列</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>awk还可以有另外一种方式来改变分隔符，那就是awk的环境变量FS，通过在BEGIN字段中设置FS值来改变分隔符。将stu记录中的tab制表符换成逗号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># sed 's/\t/,/g' stu &amp;gt; stu1</span></span><br><span class="line">root@core /home/awk<span class="comment"># mv stu1 stu</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;FS=","&#125;&#123;print $0&#125;' stu              #打印替换后的结果</span></span><br><span class="line">Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>另外，可以利用正则表达式将分隔符设置为多个字符，如下:<br>(1)FS=”\t”<br>(2)FS=”\t+”<br>对于记录 wza\t\tcq，第一种将会把该记录解析为三个域：wza、空域、cq，第二种将其解析为两个域：wza和cq</p>
<h3 id="3-_u5173_u7CFB_u548C_u5E03_u5C14_u8FD0_u7B97_u7B26"><a href="#3-_u5173_u7CFB_u548C_u5E03_u5C14_u8FD0_u7B97_u7B26" class="headerlink" title="3.关系和布尔运算符"></a>3.关系和布尔运算符</h3><p>awk定义了一组关系运算符用于awk模式匹配，如下表：</p>
<table class="table table-bordered table-striped"><tr><td>运算符</td><td>意义</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>==</td><td>等于</td></tr><tr><td>!=</td><td>不等于</td></tr><tr><td>~</td><td>匹配正则表达式</td></tr><tr><td>!~</td><td>不匹配正则表达式</td></tr><br></table>

<p>在/etc/passwd文件中存放了用户关键信息，以这个文件作为输入文件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; $1~/root/' /etc/passwd   #在第一个域中找出包含root关键字的记录</span></span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>
<p>awk在进行匹配的时候，常常使用到条件语句，awk的条件语句跟C语言的类似，有if、if/else、if/else else语句，如要匹配第三个域小于第四个的记录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; &#123;if($3&amp;lt;$4) print $0&#125;' /etc/passwd</span></span><br><span class="line">sync:x:<span class="number">4</span>:<span class="number">65534</span>:sync:/bin:/bin/sync</span><br><span class="line">games:x:<span class="number">5</span>:<span class="number">60</span>:games:/usr/games:/bin/sh</span><br><span class="line">man:x:<span class="number">6</span>:<span class="number">12</span>:man:/var/cache/man:/bin/sh</span><br><span class="line">libuuid:x:<span class="number">100</span>:<span class="number">101</span>::/var/lib/libuuid:/bin/sh</span><br><span class="line">ntp:x:<span class="number">101</span>:<span class="number">103</span>::/home/ntp:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:<span class="number">102</span>:<span class="number">65534</span>::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">shellinabox:x:<span class="number">103</span>:<span class="number">105</span>:Shell In A Box,,,:/var/lib/shellinabox:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>同C语言一样，awk也有三个逻辑运算符||、&amp;&amp;、！表示逻辑或与非:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125;&#123;if($3==10||$4==10) print $0' /etc/passwd  #匹配第三域或者第四域等于10的</span></span><br><span class="line">uucp:x:<span class="number">10</span>:<span class="number">10</span>:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125;&#123;if($3~10||$4~10) print $0&#125;' /etc/passwd    #匹配第三域或者第四域包含10的</span></span><br><span class="line">uucp:x:<span class="number">10</span>:<span class="number">10</span>:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">libuuid:x:<span class="number">100</span>:<span class="number">101</span>::/var/lib/libuuid:/bin/sh</span><br><span class="line">ntp:x:<span class="number">101</span>:<span class="number">103</span>::/home/ntp:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:<span class="number">102</span>:<span class="number">65534</span>::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">shellinabox:x:<span class="number">103</span>:<span class="number">105</span>:Shell In A Box,,,:/var/lib/shellinabox:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h3 id="4-_u8868_u8FBE_u5F0F"><a href="#4-_u8868_u8FBE_u5F0F" class="headerlink" title="4.表达式"></a>4.表达式</h3><p>与其他编程语言一样，awk表达适用于存储，操作和获取数据，一个awk表达式可由数值、字符常量、变量、操作符、函数和正则表达式自由组合而成。awk的变量只能包含数字字母和下划线，并且不能用数字开头。变量的默认数值为0，默认的字符串值为空。awk的算术运算符和其他语言基本上一样，包含<code>加(+)减(-)乘(*)除(/)模(%)乘方(^或**)变量自增(++x,x++)</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk /^$/&#123;print x+=1&#125; input   #每遇到一个空白行就加1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>向stu中加入学生的五门课的成绩，统计每个学生的平均成绩如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># cat stu                    #每个学生的各科目成绩</span></span><br><span class="line">Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line">Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line">Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line">Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># cat &amp;gt; avgscore.awk               #创建脚本，统计学生平均成绩</span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">BEGIN &#123;FS=<span class="string">","</span>&#125;</span><br><span class="line">&#123;total=<span class="variable">$4</span>+<span class="variable">$5</span>+<span class="variable">$6</span>+<span class="variable">$7</span>+<span class="variable">$8</span></span><br><span class="line">avg=total/<span class="number">5</span></span><br><span class="line"><span class="built_in">print</span> <span class="variable">$1</span>,avg&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># chmod u+x avgscore.awk            #获取可执行权限</span></span><br><span class="line">root@core /home/awk<span class="comment"># ./avgscore.awk stu                 #执行结果</span></span><br><span class="line">Li Hao <span class="number">87.4</span></span><br><span class="line">Zhang Ju <span class="number">86</span></span><br><span class="line">Wang B<span class="keyword">in</span> <span class="number">85.6</span></span><br><span class="line">Zhu L<span class="keyword">in</span> <span class="number">84</span></span><br></pre></td></tr></table></figure>
<h3 id="5-_u7CFB_u7EDF_u53D8_u91CF"><a href="#5-_u7CFB_u7EDF_u53D8_u91CF" class="headerlink" title="5.系统变量"></a>5.系统变量</h3><p>awk定义了很多内建的系统变量用于设置环境信息，这些系统变量分为两种，第一种用于改变awk的默认值，如域分隔符；第二种用于定义系统值，在处理文本的时候可以调用这些系统值，如记录中的域数量，当前记录数，当前文件名等。awk动态改变第二种系统变量的值，涉及到的变量如下：</p>
<table class="table table-bordered table-striped"><tr><td>变量名</td><td>意义</td></tr><tr><td>&amp;n</td><td>当前记录的第n个域</td></tr><tr><td>&amp;0</td><td>记录的所有域</td></tr><tr><td>ARGC=</td><td>命令行参数的数量</td></tr><tr><td>ARGIND</td><td>命令行中当前文件的位置（以0开始标号）</td></tr><tr><td>ARGV</td><td>命令行参数的数组</td></tr><tr><td>CONVFMT</td><td>数字转换格式</td></tr><tr><td>ENVIRON</td><td>环境变量关联数组</td></tr><tr><td>ERRNO</td><td>最后一个系统错误的描述</td></tr><tr><td>FILEWIDTHS</td><td>字段宽度列表，以空格键分割</td></tr><tr><td>FILENAME</td><td>当前文件名</td></tr><tr><td>FNR</td><td>浏览文件的记录数</td></tr><tr><td>FS</td><td>字段分隔符，默认是空格键</td></tr><tr><td>IGNORECASE</td><td>布尔变量，如果为真，则进行忽略大小写的匹配</td></tr><tr><td>NF</td><td>当前记录中的域数量</td></tr><tr><td>NR</td><td>当前记录数</td></tr><tr><td>OFMT</td><td>数字的输出格式</td></tr><tr><td>OFS</td><td>输出域分隔符，默认是空格键</td></tr><tr><td>ORS</td><td>输出记录分隔符，默认是换行符</td></tr><tr><td>RLENGTH</td><td>由match函数所匹配的字符串长度</td></tr><tr><td>RS</td><td>记录分隔符，默认是空格键</td></tr><tr><td>RSTART</td><td>由match函数所匹配的字符串的第一个位置</td></tr><tr><td>SUBSEP</td><td>数组下标分隔符，默认是\034</td></tr><br></table>

<p>如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;FS=","&#125;&#123;print NF,NR,$0&#125;END&#123;print FILENAME&#125;' stu</span></span><br><span class="line"><span class="number">8</span> <span class="number">1</span> Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line"><span class="number">8</span> <span class="number">2</span> Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line"><span class="number">8</span> <span class="number">3</span> Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line"><span class="number">8</span> <span class="number">4</span> Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br><span class="line">stu</span><br></pre></td></tr></table></figure>
<h3 id="6-_u683C_u5F0F_u5316_u8F93_u51FA"><a href="#6-_u683C_u5F0F_u5316_u8F93_u51FA" class="headerlink" title="6.格式化输出"></a>6.格式化输出</h3><p>print语句提供了最基本的输出格式，而awk的一大主要功能是产生报表，需要按照预定的格式输出，awk借鉴了C语言的语法，定义了printf输出语句，可以指定输出格式，基本语法如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(格式控制符，参数)</span><br></pre></td></tr></table></figure>

格式控制符都是以%符号开始，用以描述格式的规范，参数列表，比如变量名列表，与格式控制符相对应，作为输出对象。可以将格式控制符分为awk修饰符和格式符两种，如下：

<table class="table table-bordered table-striped"><tr><td>修饰符</td><td>意义</td></tr><tr><td>-</td><td>左对齐</td></tr><tr><td>width</td><td>域的步长</td></tr><tr><td>.prec</td><td>小数点右边的位数</td></tr>
</table>

<table class="table table-bordered table-striped"><tr><td>格式符</td><td>意义</td></tr><tr><td>%c</td><td>ASCII字符</td></tr><tr><td>%d</td><td>整型数</td></tr><tr><td>%e</td><td>浮点数，科学计数法</td></tr><tr><td>%f</td><td>浮点数</td></tr><tr><td>%o</td><td>八进制数</td></tr><tr><td>%s</td><td>字符串</td></tr><tr><td>%x</td><td>十六进制数</td></tr>
</table>

例如：

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=","&#125;&#123;printf("%s\t%d\n",$2,$8)&#125;' stu  #域只见用tab隔开，每输出两个换行</span></span><br><span class="line">njue    <span class="number">88</span></span><br><span class="line">nju     <span class="number">86</span></span><br><span class="line">seu     <span class="number">84</span></span><br><span class="line">njupt   <span class="number">76</span></span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;printf("%c\n",65)&#125;'                #ASCII转换</span></span><br><span class="line">A</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;printf("%.2f\n",65.101)&#125;'          #保留两位小数，与C语言一样的语法</span></span><br><span class="line"><span class="number">65.10</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=","&#125;&#123;printf("%-15s\t%s\n",$1,$3)&#125;' stu       #控%-15s制字符串长度15位并左对齐</span></span><br><span class="line">Li Hao          <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju        <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>        <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span>         <span class="number">025</span>-<span class="number">83680010</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=",";print "Name\t\tPhoneNumber"&#125;&#123;printf("%-15s\t%s\n",$1,$3)&#125;' stu    #在begin中添加输出注释</span></span><br><span class="line">Name            PhoneNumber</span><br><span class="line">Li Hao          <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju        <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>        <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span>         <span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<h3 id="7-_u5185_u7F6E_u5B57_u7B26_u4E32_u51FD_u6570"><a href="#7-_u5185_u7F6E_u5B57_u7B26_u4E32_u51FD_u6570" class="headerlink" title="7.内置字符串函数"></a>7.内置字符串函数</h3><p>awk提供了强大的内置字符串函数用于实现文本的字符串替换、查找以及分隔符等功能。如下表：</p>
<table class="table table-bordered table-striped"><tr><td>函数名</td><td>意义</td></tr><tr><td>gsub(r,s)</td><td>在输入文件中用s替换r</td></tr><tr><td>gsub(r,s,t)</td><td>在t中用s替换r</td></tr><tr><td>index(s,t)</td><td>返回s字符串中第一个t的位置</td></tr><tr><td>length(s)</td><td>返回s的长度</td></tr><tr><td>match(s,t)</td><td>测试s是否包含匹配t的字符串</td></tr><tr><td>split(r,s,t)</td><td>在t上将r分成序列s</td></tr><tr><td>sub(r,s,t)</td><td>将t中第一次出现的r替换为s</td></tr><tr><td>substr(r,s)</td><td>返回字符串r中从s开始的后缀部分</td></tr><tr><td>substr(r,s,t)</td><td>返回字符串r中从s开始长度为t的后缀部分</td></tr><br></table>

<p>gsub函数提供字符串的替换功能，gsub的第一种形式作用于全部域，即$0，第二种作用于域t。如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; gsub(/root/,"gridsphere",$1) &#123;print $0&#125;' /etc/passwd  #替换第一个域上的root字符串</span></span><br><span class="line">gridsphere x <span class="number">0</span> <span class="number">0</span> root /root /bin/bash</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; gsub(/root/,"gridsphere") &#123;print $0&#125;' /etc/passwd    #替换全部域上的root字符串</span></span><br><span class="line">gridsphere:x:<span class="number">0</span>:<span class="number">0</span>:gridsphere:/gridsphere:/bin/bash</span><br></pre></td></tr></table></figure>
<p>index函数返回第二个字符串在第一个字符串中出现的首位置，length函数返回字符串的长度：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print index("gayyzxyx","yx")&#125;'</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;print length("gayyzxyx")&#125;'</span></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>match(s,t)测试s是否包含匹配t的字符串，t可以是一个正则表达式，若匹配成功就返回t的首位置，否则返回0,如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print match("gAyyzxyx",/A/)&#125;'</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>sub(r,s,t)只替换模式出现的第一个位置，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;str="multiprocessor programming";sub(/pro/,"PRO",str);printf("%s\n",str)&#125;'</span></span><br><span class="line"><span class="comment">#只有第一个pro被替换了</span></span><br><span class="line">multiPROcessor programming</span><br></pre></td></tr></table></figure>
<p>substr返回字符串的指定后缀，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;str="multiprocessor programming";print substr(str,6)&#125;'</span></span><br><span class="line">processor programming</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;str="multiprocessor programming";print substr(str,6,9)&#125;'   #第6个位置开始，长度为9</span></span><br><span class="line">processor</span><br></pre></td></tr></table></figure>
<h3 id="8-_u5411AWK_u811A_u672C_u4F20_u9012_u53C2_u6570"><a href="#8-_u5411AWK_u811A_u672C_u4F20_u9012_u53C2_u6570" class="headerlink" title="8.向AWK脚本传递参数"></a>8.向AWK脚本传递参数</h3><p>awk脚本内的变量可以在命令行中进行赋值，实现向awk脚本传递参数，格式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk脚本 parameter=value 输入文件</span><br></pre></td></tr></table></figure>

参数可以是自定义的变量，也可以是系统变量。如下：

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># cat pass.awk </span></span><br><span class="line"><span class="comment">#判断记录的域数量是否等于MAX数量，如果不等于则输出包含NR和MAX两个变量的文本行</span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">NF!=MAX</span><br><span class="line">&#123;<span class="built_in">print</span>(<span class="string">"the line "</span>NR<span class="string">" does  not have "</span>MAX<span class="string">" filds"</span>)&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># ./pass.awk MAX=3 FS="," stu</span></span><br><span class="line">Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line">the line <span class="number">1</span> does  not have <span class="number">3</span> filds</span><br><span class="line">Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line">the line <span class="number">2</span> does  not have <span class="number">3</span> filds</span><br><span class="line">Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line">the line <span class="number">3</span> does  not have <span class="number">3</span> filds</span><br><span class="line">Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br><span class="line">the line <span class="number">4</span> does  not have <span class="number">3</span> filds</span><br></pre></td></tr></table></figure>
<p>以下是输出stu的所有记录，每条记录加上行号(即NR变量值),然后重新定义OFS值，改变域的分隔符，即NR和$0之间用OFS定义的值分割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;FS=","&#125; &#123;print(NR,$0)&#125;' OFS="." stu</span></span><br><span class="line"><span class="number">1</span>.Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line"><span class="number">2</span>.Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line"><span class="number">3</span>.Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line"><span class="number">4</span>.Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，命令行参数不能被BEGIN字段语句访问，换句话说，直到输入文件的第一行被读取时，命令行参数才生效，如下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk '</span></span><br><span class="line">&amp;gt; BEGIN &#123;<span class="built_in">print</span> n&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-_u6761_u4EF6_u8BED_u53E5_u548C_u5FAA_u73AF_u8BED_u53E5"><a href="#9-_u6761_u4EF6_u8BED_u53E5_u548C_u5FAA_u73AF_u8BED_u53E5" class="headerlink" title="9.条件语句和循环语句"></a>9.条件语句和循环语句</h3><p>awk的条件语句和循环语句的语法跟C语言的完全一样，有如下形式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (条件表达式)</span><br><span class="line">    动作<span class="number">1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	动作<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(x==y) <span class="built_in">print</span> x</span><br><span class="line"><span class="keyword">if</span>(x~/正则表达式/) <span class="built_in">print</span> x</span><br><span class="line"><span class="comment">#也可以while或者do&#123;&#125;while</span></span><br><span class="line"><span class="keyword">while</span>(条件表达式)</span><br><span class="line">	动作</span><br><span class="line"><span class="comment">#还可以for循环</span></span><br><span class="line"><span class="keyword">for</span>(初值，计数器，计数器变化)</span><br><span class="line">	动作</span><br></pre></td></tr></table></figure>
<h3 id="10-_u6570_u7EC4"><a href="#10-_u6570_u7EC4" class="headerlink" title="10.数组"></a>10.数组</h3><p>awk的数组的形式跟C语言的一样，但是awk数组无需定义数组类型和大小，可以直接赋值使用，基本格式为:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array[index]=value</span><br></pre></td></tr></table></figure>

1\.关联数组

关联数组的意思是数组的索引既可以是字符串也可以是数字。在大部分编程语言中数组的索引只能是数字，而awk的不是这样。安维卡的所有数组都是关联数组，这是awk数组和其他大部分编程语言的数组的区别。

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;data[10.15]="1200";CONVFMT="%d";printf("&amp;lt;%s&amp;gt;",ta[10.15])&#125;'   #字符串和数字是严格区分的</span></span><br><span class="line">&amp;lt;&amp;gt;</span><br></pre></td></tr></table></figure>
<p>awk定义了一种特别的for循环来访问关联数组，array是定义的数组名，variable是任意指定的变量，</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(variable <span class="keyword">in</span> array)</span><br><span class="line">	<span class="keyword">do</span> something with array[variable]</span><br></pre></td></tr></table></figure>
<p>关键字in也可以用在条件表达式中判断元素是否在数组中，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index <span class="keyword">in</span> array</span><br></pre></td></tr></table></figure>

如果array[index]存在，返回1，否则返回0,如下

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;data[10.15]="1200";if("10.15" in data) print "found element!"&#125;'</span></span><br><span class="line">found element!</span><br></pre></td></tr></table></figure>
<p>2.split函数</p>
<p>split函数的返回值是数组的大小，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print split("abc/def/xyz",str,"/")&#125;'    #将字符串abc/def/xyz分开，并存在str中</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;split("abc/def/xyz",str,"/");for(i in str) print str[i]&#125;'  #分别打印出来如下</span></span><br><span class="line">abc</span><br><span class="line">def</span><br><span class="line">xyz</span><br></pre></td></tr></table></figure>
<p>3.数组形式的系统变量</p>
<p>awk系统变量中有两个变量是以数组的形式提供的：<code>ARGV</code>和<code>ENVIRON</code>，ARGC是ARGV中数组中元素的个数，与C语言一样，从ARGV[0]开始到ARGV[ARGC-1]结束，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># cat &amp;gt; argv.awk</span></span><br><span class="line">BEGIN&#123;<span class="keyword">for</span>(x=<span class="number">0</span>;x&amp;lt;ARGC;x++)</span><br><span class="line"><span class="built_in">print</span> ARGV[x]</span><br><span class="line"><span class="built_in">print</span> ARGC</span><br><span class="line">&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># awk -f argv.awk xyz n=99 hello world    #xyz,n,hello world都是参数，可以看到awk[0]存的是awk,-f选项不在ARGV中，一般来说当不是执行脚本文件的时候，ARGC=2，如果没有输入文件，ARGC=1</span></span><br><span class="line">awk</span><br><span class="line">xyz</span><br><span class="line">n=<span class="number">99</span></span><br><span class="line">hello world</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>如果要查找文件中内容，比如我们输入学生名字查找出学生的电话号码，可以如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/awk -f               #findphone.awk的脚本</span></span><br><span class="line">BEGIN&#123;FS=<span class="string">","</span>;</span><br><span class="line">	<span class="keyword">if</span>(ARGC&amp;gt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="comment">#判断是否已经输入姓名</span></span><br><span class="line">		name=ARGV[<span class="number">1</span>];</span><br><span class="line">		delete ARGV[<span class="number">1</span>]&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(!name)&#123;<span class="built_in">print</span> <span class="string">"please enter a name"</span>;</span><br><span class="line">			getline name&amp;lt; <span class="string">"-"</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$1</span> ~name &#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># ./findphone.awk Zhu stu</span></span><br><span class="line">Zhu L<span class="keyword">in</span> <span class="number">025</span>-<span class="number">83680010</span></span><br><span class="line">root@core /home/awk<span class="comment"># ./findphone.awk stu</span></span><br><span class="line">please enter a name</span><br><span class="line">Zhu</span><br><span class="line">Zhu L<span class="keyword">in</span> <span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>ENVIRON变量存储了LINUX系统中的环境变量，如下可以打印出系统中ENVIRON数组中所有内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;for (i in ENVIRON) print i "=" ENVIRON[i]&#125;'</span></span><br><span class="line">SSH_CLIENT=<span class="number">192.168</span>.<span class="number">115.1</span> <span class="number">49633</span> <span class="number">22</span></span><br><span class="line">EDITOR=vim</span><br><span class="line">HOME=/root</span><br><span class="line">PAGER=less -X -R -F</span><br><span class="line">TERM=xterm</span><br><span class="line">LESSOPEN=| /usr/bin/lesspipe %s</span><br><span class="line">LANGUAGE=en_US.UTF-<span class="number">8</span></span><br><span class="line">LC_ALL=C</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">OLDPWD=/root</span><br><span class="line">USER=root</span><br><span class="line">_=/usr/bin/awk</span><br><span class="line">SHLVL=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ENVIRON索引的是环境变量名，因此也可以通过环境变量名得到其值：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print ENVIRON["HOME"]&#125;'</span></span><br><span class="line">/root</span><br></pre></td></tr></table></figure>
<p>最后看一个排序，对输入数组data:4,90,6.9,8,10,1,60,7.8,9.3进行排序，结合数组和逻辑控制，采用简单冒泡排序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">BEGIN &#123;FS=<span class="string">","</span>&#125; &#123;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>;i&amp;lt;NF;i++)&#123;</span><br><span class="line">		k=i</span><br><span class="line">	<span class="keyword">for</span>(j=i+<span class="number">1</span>;j&amp;lt;=NF;j++)</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&amp;lt;<span class="variable">$k</span>) k=j</span><br><span class="line">			temp=<span class="variable">$i</span>;<span class="variable">$i</span>=<span class="variable">$k</span>;<span class="variable">$k</span>=temp;&#125;</span><br><span class="line">	<span class="built_in">print</span> <span class="variable">$0</span></span><br><span class="line">&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># ./sort.awk  data   #排序结果</span></span><br><span class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">6.9</span> <span class="number">7.8</span> <span class="number">8</span> <span class="number">9.3</span> <span class="number">10</span> <span class="number">60</span> <span class="number">90</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/04/22/python/2013-04-22-python-django/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          搭建简易web框架django
        
      </div>
    </a>
  
  
    <a href="/2013/02/25/algorithm/2013-02-25-algorithms/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">算法之路，任重道远</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="shell/2013-03-02-Awk" data-title="文本处理神器sed与awk命令使用(续)" data-url="http://yoursite.com/2013/03/02/shell/2013-03-02-Awk/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Kenshin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>