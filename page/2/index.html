<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Kenshin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Kenshin">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Kenshin">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kenshin">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Kenshin" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/author.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Kenshin</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="GitHub" target="_blank" href="https://github.com/gayyzxyx" title="GitHub">GitHub</a>
					        
								<a class="Email" target="_blank" href="/yao.rid@gmail.com" title="Email">Email</a>
					        
								<a class="LinkedIn" target="_blank" href="https://www.linkedin.com/in/xin-yao-713b2b78" title="LinkedIn">LinkedIn</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BIO/" style="font-size: 12.5px;">BIO</a> <a href="/tags/ConcurrentModificationException/" style="font-size: 10px;">ConcurrentModificationException</a> <a href="/tags/NIO/" style="font-size: 12.5px;">NIO</a> <a href="/tags/Netty/" style="font-size: 15px;">Netty</a> <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/awk/" style="font-size: 12.5px;">awk</a> <a href="/tags/bottle/" style="font-size: 10px;">bottle</a> <a href="/tags/crack/" style="font-size: 10px;">crack</a> <a href="/tags/date/" style="font-size: 10px;">date</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/fe/" style="font-size: 10px;">fe</a> <a href="/tags/java/" style="font-size: 17.5px;">java</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/maketrans/" style="font-size: 10px;">maketrans</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/pptp/" style="font-size: 10px;">pptp</a> <a href="/tags/putty/" style="font-size: 10px;">putty</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/reflection/" style="font-size: 10px;">reflection</a> <a href="/tags/sed/" style="font-size: 12.5px;">sed</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/shell/" style="font-size: 20px;">shell</a> <a href="/tags/ssh/" style="font-size: 12.5px;">ssh</a> <a href="/tags/sublime-text2/" style="font-size: 10px;">sublime text2</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/translate/" style="font-size: 10px;">translate</a> <a href="/tags/vpn/" style="font-size: 10px;">vpn</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Kenshin</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/author.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Kenshin</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="GitHub" target="_blank" href="https://github.com/gayyzxyx" title="GitHub">GitHub</a>
			        
						<a class="Email" target="_blank" href="/yao.rid@gmail.com" title="Email">Email</a>
			        
						<a class="LinkedIn" target="_blank" href="https://www.linkedin.com/in/xin-yao-713b2b78" title="LinkedIn">LinkedIn</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-shell/2015-12-28-git-rename" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/28/shell/2015-12-28-git-rename/" class="article-date">
  	<time datetime="2015-12-27T16:00:00.000Z" itemprop="datePublished">2015-12-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/28/shell/2015-12-28-git-rename/">git一键rename</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有时候需要修改分支名称，但是总是几条命令切来切去麻烦，于是写了个简单的脚本如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [[ ! <span class="operator">-d</span> <span class="string">".git"</span> ]];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"不是有效git目录"</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$#</span>"</span> <span class="operator">-ne</span> <span class="number">1</span> ]];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"新分支名必填"</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">branch_old=`git status|grep <span class="string">"On branch"</span>|awk <span class="string">'&#123;print $3&#125;'</span>`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$branch_old</span>"</span> = <span class="string">"master"</span> ]];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"不能对master操作"</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">git branch -m <span class="variable">$branch_old</span> <span class="variable">$1</span></span><br><span class="line">git push origin :<span class="variable">$branch_old</span></span><br><span class="line">git push origin <span class="variable">$1</span></span><br></pre></td></tr></table></figure><br>然后配置到环境变量，需要的时候git-rename branchname即可</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2015-12-22-del-nulltext" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/22/shell/2015-12-22-del-nulltext/" class="article-date">
  	<time datetime="2015-12-21T16:00:00.000Z" itemprop="datePublished">2015-12-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/22/shell/2015-12-22-del-nulltext/">关于去除空行以及行截断</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在处理文档的时候有时候中间会有空行，这时候需要将其去除，有以下几种办法</p>
<p>1.grep<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">"^$"</span> filename</span><br></pre></td></tr></table></figure><br>2.sed<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat filename|sed <span class="string">'/^$/d'</span></span><br></pre></td></tr></table></figure><br>3.tr(不推荐，会保留第一个)<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat filename|tr <span class="operator">-s</span> <span class="string">'\n'</span></span><br></pre></td></tr></table></figure><br>4.awk<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat filename|awk <span class="string">'&#123;if($0!="")print&#125;'</span></span><br></pre></td></tr></table></figure><br>处理完后，还会将每一行按照一定规则进行截断，这是进行cut处理就行了<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut <span class="operator">-d</span> <span class="string">"分隔符"</span> <span class="operator">-f</span> 段</span><br></pre></td></tr></table></figure><br>比如将1155068178\处理成1155068178，只需要写成这样<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut <span class="operator">-d</span> <span class="string">"\\"</span> <span class="operator">-f</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-other/2015-12-18-vpn" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/18/other/2015-12-18-vpn/" class="article-date">
  	<time datetime="2015-12-17T16:00:00.000Z" itemprop="datePublished">2015-12-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/18/other/2015-12-18-vpn/">搭梯子姿势界定</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="shadowsocks"><a href="#shadowsocks" class="headerlink" title="shadowsocks"></a>shadowsocks</h2><p>受够了GFW的孽性，忍无可忍之下强迫自建梯子。买的conoha的vps，但是发现用它在搭建pptp服务的时候，一直连不上，错误的log如下：</p>
<pre><code>Dec 18 12:09:18 133-130-xx-xxx pptpd[6401]: CTRL: Client 120.132.35.131 control connection started
Dec 18 12:09:18 133-130-xx-xxx pptpd[6401]: CTRL: Starting call (launching pppd, opening GRE)
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: Plugin /usr/lib/pptpd/pptpd-logwtmp.so loaded.
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: pppd 2.4.6 started by root, uid 0
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: Using interface ppp0
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: Connect: ppp0 &lt;--&gt; /dev/pts/2
Dec 18 12:09:18 133-130-xx-xxx pptpd[6401]: GRE: Bad checksum from pppd.
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: LCP: timeout sending Config-Requests
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: Connection terminated.
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: Modem hangup
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: Exit.
</code></pre><p>google下发现原来我不是一个人:<br><img src="/img/other/pptp_error_1.jpeg" alt="sign" width="100%"><br>原因推测是GRE协议被<code>conoha</code>封锁，没办法只好换成Shadowsocks。</p>
<p>1.安装依赖包<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install build-essential autoconf libtool libssl-dev gawk debhelper git</span><br></pre></td></tr></table></figure><br>2.下载源码<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/madeye/shadowsocks-libev.git</span><br></pre></td></tr></table></figure><br>3.直接安装<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> shadowsocks-libev &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><br>4.配置文件修改</p>
<pre><code>{
    &quot;server&quot;:&quot;0.0.0.0&quot;,             #服务端监听地址(IPv4或IPv6)
    &quot;server_port&quot;:8388,             #服务端端口，一般默认8388
    &quot;local_address&quot;:&quot;127.0.0.1&quot;,    #本地监听地址，缺省为127.0.0.1
    &quot;local_port&quot;:1080,              #本地监听端口，一般为1080
    &quot;password&quot;:&quot;password&quot;,          #用以加密的密匙   
    &quot;timeout&quot;:600,                  #超时时间（秒）
    &quot;method&quot;:&quot;aes-256-cfb&quot;          #加密方式，选择aes-256-cfb安全性较强
}
</code></pre><p>5.启动<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/shadowsocks start</span><br></pre></td></tr></table></figure></p>
<h2 id="socks5"><a href="#socks5" class="headerlink" title="socks5"></a>socks5</h2><p>也可以通过ssh端口转发，系统设置socks5代理<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -N -D <span class="number">7070</span> root@<span class="number">133.130</span>.<span class="number">57.222</span></span><br></pre></td></tr></table></figure><br>然后在系统代码的地方设置socks5,连接本地ip:port,如127.0.0.1:7070<br><img src="/img/other/socks5.jpg" alt="socks5" width="100%"><br>这样就可以愉快上网了，通过chrome插件可以实现自动代理。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pptp/">pptp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shadowsocks/">shadowsocks</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vpn/">vpn</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/other/">other</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2014-02-27-linux-date-syn" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/02/27/shell/2014-02-27-linux-date-syn/" class="article-date">
  	<time datetime="2014-02-26T16:00:00.000Z" itemprop="datePublished">2014-02-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/02/27/shell/2014-02-27-linux-date-syn/">解决debian时间差8小时</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.更改时区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Asia/Shanghai"</span> &gt; /etc/timezone</span><br></pre></td></tr></table></figure>

2\.根据时区覆盖原有的localtime文件

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/localtime /etc/localtime.bak</span><br><span class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/</span><br><span class="line">mv /etc/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<p>3.查看rcS文件中是否有UTC</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/default/rcS</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"UTC=no"</span> &gt;&gt; /etc/default/rcS</span><br></pre></td></tr></table></figure>
<p>4.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ntpdate</span><br></pre></td></tr></table></figure></p>
<p>5.更新时间<code>ntpdate ntp.fudan.edu.cn</code> ,如果提示错误，执行<code>service ntp stop</code>, 然后<code>ntpdate ntp.fudan.edu.cn</code>，然后date看下时间就妥妥的了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/date/">date</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python/2013-10-06-file-synchronise" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/10/06/python/2013-10-06-file-synchronise/" class="article-date">
  	<time datetime="2013-10-05T16:00:00.000Z" itemprop="datePublished">2013-10-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/06/python/2013-10-06-file-synchronise/">文件同步</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有时候需要用到文件同步将本地文件与远程文件保持一致，可以是全量的，也可以是增量的，于是用py简单撸了下。简单来说就是遍历当前文件夹，如果当前是文件则检测目标文件夹中是否存在该文件，不存在就复制；如果检测到的是文件夹，则递归检测子文件夹，核心如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Syn</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dPath)</span>:</span></span><br><span class="line">        self.sPath = os.getcwd()</span><br><span class="line">        self.dPath = dPath</span><br><span class="line">        self.absFolder = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copyFile</span><span class="params">(self, path)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(os.path.join(path, i)):</span><br><span class="line">                sourceFile = os.path.join(os.path.join(self.sPath, self.absFolder), i)</span><br><span class="line">                targetFile = os.path.join(os.path.join(self.dPath , self.absFolder), i)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> (os.path.exists(targetFile) <span class="keyword">and</span> os.path.getsize(targetFile) == os.path.getsize(sourceFile)):</span><br><span class="line">                    open(targetFile, <span class="string">"wb"</span>).write(open(sourceFile, <span class="string">"rb"</span>).read())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                targetPath = os.path.join(os.path.join(self.dPath, self.absFolder), i)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(targetPath):</span><br><span class="line">                    self.absFolder = os.path.join(self.absFolder, i)</span><br><span class="line">                    os.makedirs(targetPath)</span><br><span class="line">                    self.copyFile(os.path.join(self.sPath, self.absFolder))</span><br><span class="line">                    self.absFolder = os.path.split(self.absFolder)[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.absFolder = os.path.join(self.absFolder, i)</span><br><span class="line">                    self.copyFile(os.path.join(self.sPath, self.absFolder))</span><br><span class="line">                    self.absFolder = os.path.split(self.absFolder)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>对了全量同步，只需要在同步前把目标文件夹给删除掉。在程序运行前带入参数。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">   target = sys.argv[<span class="number">2</span>].decode(<span class="string">"utf-8"</span>).encode(<span class="string">"gbk"</span>)</span><br><span class="line">   <span class="keyword">if</span> sys.argv[<span class="number">1</span>]==<span class="string">"all"</span>:</span><br><span class="line">       <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(target):</span><br><span class="line">           <span class="keyword">try</span>:</span><br><span class="line">               <span class="keyword">if</span> os.path.isfile(os.path.join(target, file)):</span><br><span class="line">                   os.remove(os.path.join(target, file))</span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   os.system(<span class="string">'rd /S /Q %s'</span>% os.path.join(target, file))</span><br><span class="line">           <span class="keyword">except</span> Exception,e:</span><br><span class="line">               <span class="keyword">print</span> e, file</span><br><span class="line">   syn = Syn(target)</span><br><span class="line">   syn.copyFile(os.getcwd())</span><br><span class="line">   <span class="keyword">print</span> <span class="string">"success"</span></span><br></pre></td></tr></table></figure>
<p>核心代码不超过20行，但是为日常应用带来了很大的方便。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-09-03-sort-uniq-join-tr" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/09/03/shell/2013-09-03-sort-uniq-join-tr/" class="article-date">
  	<time datetime="2013-09-02T16:00:00.000Z" itemprop="datePublished">2013-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/09/03/shell/2013-09-03-sort-uniq-join-tr/">关于文件基本处理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>文件处理围绕着sort、uniq、join、cut、paste、split、tr、tar等命令，这些与sed和awk组合起来构成了linux文本处理的所有命令和工具。</p>
<h2 id="1-sort_u547D_u4EE4"><a href="#1-sort_u547D_u4EE4" class="headerlink" title="1.sort命令"></a>1.sort命令</h2><p>sort命令将输入文件看成是有多条记录组成的数据流，记录由可变宽度的字符组成，以换行符作为界定符。其与awk命令一样，也可以指令域分隔符，不一样的是sort的分割符是-t选项，而awk是F。sort的常用选项如下：</p>
<table class="table table-bordered table-striped"><tr><td>选项</td><td>意义</td></tr><tr><td>-c</td><td>测试文件是否已经被排序</td></tr><tr><td>-k</td><td>指定排序的域</td></tr><tr><td>-m</td><td>合并两个已排序的文件</td></tr><tr><td>-n</td><td>根据数字大小进行排序</td></tr><tr><td>-o[输出文件</td><td>重定向</td></tr><tr><td>-r</td><td>将排序结果逆向显示</td></tr><tr><td>-t</td><td>改变域分隔符</td></tr><tr><td>-u</td><td>去除结果中的重复行</td></tr><br></table>

<h3 id="1-1-t_u9009_u9879"><a href="#1-1-t_u9009_u9879" class="headerlink" title="1.1.-t选项"></a>1.1.-t选项</h3><p>sort的默认分隔符是空格，在t后面紧跟分割符号就可以指定域</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db</span></span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line"></span><br><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t:  #指定分隔符:后</span></span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br></pre></td></tr></table></figure>
<h3 id="1-2-k_u9009_u9879"><a href="#1-2-k_u9009_u9879" class="headerlink" title="1.2.-k选项"></a>1.2.-k选项</h3><p>sort默认是按第一个域进行排序的，可以指定第n个域进行排序如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t: -k2</span></span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br></pre></td></tr></table></figure>
<h3 id="1-3-n_u9009_u9879"><a href="#1-3-n_u9009_u9879" class="headerlink" title="1.3.-n选项"></a>1.3.-n选项</h3><p>-n表示按数字大小进行排序。如果不指定-n选项，在排序的时候默认按当前域的字符序列进行排序，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t: -k3n</span></span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br></pre></td></tr></table></figure>
<h3 id="1-4-r_u9009_u9879"><a href="#1-4-r_u9009_u9879" class="headerlink" title="1.4.-r选项"></a>1.4.-r选项</h3><p>-r用于将排序的结果逆向显示，如果要按数值降序可按如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t: -k3nr</span></span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br></pre></td></tr></table></figure>
<h3 id="1-5-u_u9009_u9879"><a href="#1-5-u_u9009_u9879" class="headerlink" title="1.5.-u选项"></a>1.5.-u选项</h3><p>-u用于去除重复选行，在上面文件中加入几个重复行，用-u过滤后如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db |sort -t: -u</span></span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br></pre></td></tr></table></figure>
<h3 id="1-6-o_u9009_u9879"><a href="#1-6-o_u9009_u9879" class="headerlink" title="1.6.-o选项"></a>1.6.-o选项</h3><p>一般用sort排序后都是将结果直接输出到屏幕或者管道，也可以直接输出到文件，跟IO重定向一个效果。如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db |sort -t: -u -o com1.db</span></span><br></pre></td></tr></table></figure>
<h3 id="1-7-c_u7528_u4E8E_u6D4B_u8BD5_u6587_u4EF6_u662F_u5426_u5DF2_u7ECF_u6392_u597D_u5E8F"><a href="#1-7-c_u7528_u4E8E_u6D4B_u8BD5_u6587_u4EF6_u662F_u5426_u5DF2_u7ECF_u6392_u597D_u5E8F" class="headerlink" title="1.7.-c用于测试文件是否已经排好序"></a>1.7.-c用于测试文件是否已经排好序</h3><p>刚刚的com1.db是已经排好序的文件，测试如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># sort -t: -c com1.db</span></span><br><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>如果没有排好序结果如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># sort -t: -c computer.db</span></span><br><span class="line">sort: computer.db:<span class="number">2</span>: disorder: thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br></pre></td></tr></table></figure>
<h3 id="1-8-_u5C06_u6392_u597D_u5E8F_u7684_u4E24_u4E2A_u6587_u4EF6_u5408_u5E76_u6210_u4E00_u4E2A_u524D_u63D0_u662F_u4E24_u4E2A_u6587_u4EF6_u90FD_u5FC5_u987B_u662F_u5DF2_u7ECF_u6392_u597D_u5E8F_u7684"><a href="#1-8-_u5C06_u6392_u597D_u5E8F_u7684_u4E24_u4E2A_u6587_u4EF6_u5408_u5E76_u6210_u4E00_u4E2A_u524D_u63D0_u662F_u4E24_u4E2A_u6587_u4EF6_u90FD_u5FC5_u987B_u662F_u5DF2_u7ECF_u6392_u597D_u5E8F_u7684" class="headerlink" title="1.8.将排好序的两个文件合并成一个前提是两个文件都必须是已经排好序的"></a>1.8.将排好序的两个文件合并成一个前提是两个文件都必须是已经排好序的</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python/2013-08-10-add-screen-forpi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/10/python/2013-08-10-add-screen-forpi/" class="article-date">
  	<time datetime="2013-08-09T16:00:00.000Z" itemprop="datePublished">2013-08-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/10/python/2013-08-10-add-screen-forpi/">给树莓派添加显示屏</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>给树莓派添加一个外部的黑白屏用于显示运行状态，包括温度，内存，cpu使用，ip地址等等，屏幕用诺基亚5100的拆机屏。需要用到一个函数库，在Raspberry Pi的讨论区中已经有人共享了成果<a href="http://www.raspberrypi.org/phpBB3/download/file.php?id=2239&amp;sid=54ab6c13f737d4df57d295afa8bf3752" target="_blank" rel="external">nokimagpi.tar.gz</a>。由于这个程序用到一些modules，需要装一些环境支持:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-dev</span><br><span class="line">sudo apt-get install python-pip</span><br><span class="line">sudo pip install wiringpi</span><br><span class="line">sudo pip install spidev</span><br><span class="line">sudo pip install pil</span><br></pre></td></tr></table></figure>
<p>5100显示屏的针脚定义从左到右依次是：RST,CE,DC(D/C),Din(DNK),Clk(SCLK),Vcc,BL(LED),Gnd,总共8根线，将其连接到树莓派的gpio口，对应关系如下(将pi的网口端正对自己，从左往右，依次向下分别为pin 1 2 3…)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RST ←→ pin <span class="number">11</span></span><br><span class="line">CE (SCE) ←→ pin <span class="number">24</span></span><br><span class="line">DC (D/C)  ←→ pin <span class="number">15</span></span><br><span class="line">Din (DNK) ←→ pin <span class="number">19</span></span><br><span class="line">Clk (SCLK) ←→ pin <span class="number">23</span></span><br><span class="line">Vcc  ←→ pin <span class="number">1</span></span><br><span class="line">BL(LED) ←→ pin <span class="number">12</span></span><br><span class="line">Gnd  ←→ pin <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>接下来写脚本调用<code>nokiaSPI.py</code>控制屏幕输出，常用的方法如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nokia.cls()：清除显示</span><br><span class="line">nokia.gotoxy(x, y)：將游标移动到 x, y 指定的位置。</span><br><span class="line">nokia.text(<span class="string">"英文字串"</span>)：在目前的屏幕中显示英文字符。</span><br><span class="line">nokia.led(<span class="number">0</span>)：关闭背光</span><br></pre></td></tr></table></figure>
<p>需要用到显示相关信息的方法如下，获取内存和CPU占用需要用到psutil包：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取IP地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getIp</span><span class="params">()</span>:</span></span><br><span class="line">    ipAdd = commands.getstatusoutput(<span class="string">"ifconfig|grep 'inet addr:'|grep -v '127.0.0.1'|awk '&#123;print $2&#125;'|awk -F':' '&#123;print $2&#125;'"</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> ipAdd</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取温度信息</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTempurature</span><span class="params">()</span>:</span></span><br><span class="line">	tempurature = str(string.atoi(commands.getstatusoutput(<span class="string">"cat /sys/class/thermal/thermal_zone0/temp"</span>)[<span class="number">1</span>])/<span class="number">1000.0</span>)</span><br><span class="line">	<span class="keyword">return</span> tempurature</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取CPU占用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCpuUseage</span><span class="params">()</span>:</span></span><br><span class="line">	cpu = <span class="string">"cpu:"</span>+str(psutil.cpu_percent(<span class="number">0.1</span>))+<span class="string">"%"</span></span><br><span class="line">    <span class="keyword">return</span> cpu</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取内存占用情况</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getMem</span><span class="params">()</span>:</span></span><br><span class="line">    phymem = psutil.phymem_usage()</span><br><span class="line">    buffers = getattr(psutil, <span class="string">'phymem_buffers'</span>, <span class="keyword">lambda</span>: <span class="number">0</span>)()</span><br><span class="line">    cached = getattr(psutil, <span class="string">'cached_phymem'</span>, <span class="keyword">lambda</span>: <span class="number">0</span>)()</span><br><span class="line">    used = phymem.total - (phymem.free + buffers + cached)</span><br><span class="line">    line = <span class="string">"Mem:%s/%s"</span> % (</span><br><span class="line">        str(int(used / <span class="number">1024</span> / <span class="number">1024</span>)) + <span class="string">"M"</span>,</span><br><span class="line">        str(int(phymem.total / <span class="number">1024</span> / <span class="number">1024</span>)) + <span class="string">"M"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> line</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取开机运行时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUpTime</span><span class="params">()</span>:</span></span><br><span class="line">    time = commands.getstatusoutput(<span class="string">"uptime|awk -F',' '&#123;print $1&#125;'|awk '&#123;print $3&#125;'"</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> time</span><br></pre></td></tr></table></figure>
<p>运行后的效果<br><img src="/img/pi/screen.jpg" alt="sign"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-07-14-Nginx-MultiPort" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/07/14/shell/2013-07-14-Nginx-MultiPort/" class="article-date">
  	<time datetime="2013-07-13T16:00:00.000Z" itemprop="datePublished">2013-07-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/07/14/shell/2013-07-14-Nginx-MultiPort/">使用nginx解决BOTTLE单例</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>bottle的单例访问让人蛋疼，本来就不高的并发，为了解决这种问题想到了nginx代理多端口转发。首先在程序里面将端口改成动态传入,在main.py中修改：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">args = sys.argv</span><br><span class="line"><span class="comment">#默认args[0]是文件的名字 args[1],[2]等依次是后面跟着的参数</span></span><br><span class="line">port = string.atoi(args[<span class="number">1</span>])  </span><br><span class="line">. </span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">run(app,host=host,port=port)</span><br></pre></td></tr></table></figure><br>启动实例的端口由shell脚本带入，需要再次写以下脚本，表示根据shell带进的入参，依次启动实例：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"> </span></span><br><span class="line"> <span class="built_in">cd</span> /home/pi/gayyzxyx-manage/gayyzxyx-manage-<span class="number">8080</span>/</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> [ <span class="variable">$#</span> = <span class="number">0</span> ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"pls input ports"</span></span><br><span class="line">     <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"> file=main.py</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> [ ! <span class="operator">-f</span> <span class="variable">$file</span> ]; <span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"main.py does't exist"</span></span><br><span class="line">     <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">for</span> port <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">     python main.py <span class="variable">$port</span>&gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure><br>接着修改nginx动态代理如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">upstream bottle&#123;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span>;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span>;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8082</span>;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8083</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       charset        utf-<span class="number">8</span>;</span><br><span class="line">       server &#123;</span><br><span class="line">           listen       <span class="number">80</span>;</span><br><span class="line">           server_name  localhost;</span><br><span class="line">   </span><br><span class="line">           <span class="preprocessor">#charset koi8-r;</span></span><br><span class="line">   </span><br><span class="line">           <span class="preprocessor">#access_log  logs/host.access.log  main;</span></span><br><span class="line">   </span><br><span class="line">           location / &#123;</span><br><span class="line">               <span class="preprocessor">#root   html;</span></span><br><span class="line">               <span class="preprocessor">#index  index.html index.htm;</span></span><br><span class="line">               proxy_pass              http:<span class="comment">//bottle;</span></span><br><span class="line">               proxy_set_header        Host             $host;</span><br><span class="line">               proxy_set_header        X-Real-IP        $remote_addr;</span><br><span class="line">               proxy_set_header        X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">           &#125;</span><br><span class="line">           .</span><br><span class="line">           .</span><br><span class="line">           .</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><br>其中在upstream中加入需要启动实例的ip:port，在上面的shell脚本中写了几个就需要在这里配置几个，至此基本上配置完成。先通过./xx.sh 8080 8081 8082 8083先启动实例，查看进程会发现如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/usr/<span class="built_in">local</span>/nginx/<span class="number">1.4</span>.<span class="number">1</span><span class="comment"># ps -ef | grep python | grep -v grep</span></span><br><span class="line">root     <span class="number">19567</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span> python main.py <span class="number">8080</span></span><br><span class="line">root     <span class="number">19568</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span> python main.py <span class="number">8081</span></span><br><span class="line">root     <span class="number">19569</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span> python main.py <span class="number">8082</span></span><br><span class="line">root     <span class="number">19570</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">04</span> python main.py <span class="number">8083</span></span><br></pre></td></tr></table></figure><br>接着启动nginx,在远程电脑上访问192.168.1.105，可以发现每个实例都有转发内容 </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bottle/">bottle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-06-18-grep" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/06/18/shell/2013-06-18-grep/" class="article-date">
  	<time datetime="2013-06-17T16:00:00.000Z" itemprop="datePublished">2013-06-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/06/18/shell/2013-06-18-grep/">LINUX下GREP简易用法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Usage: grep [OPTION]… PATTERN [FILE]…Search for PATTERN in each FILE or standard input.PATTERN is, by default, a basic regular expression (BRE).Example: grep -i ‘hello world’ menu.h main.c</strong></p>
<p>1.-A NUM 显示匹配行下的NUM行:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -A 1 bash download_chrome.sh</span></span><br><span class="line">!bin/bash</span><br><span class="line">VERSION=<span class="string">"curl http://commondatastorage.googleapis.com/chromium-browser-continuous/Win/LAST_CHANGE"</span></span><br></pre></td></tr></table></figure><br>2.-a 搜寻二进制档案中文本</p>
<p>3.-B NUM 显示匹配行以上的NUM行:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -B 1 VERSION download_chrome.sh</span></span><br><span class="line">!bin/bash</span><br><span class="line">VERSION=<span class="string">"curl http://commondatastorage.googleapis.com/chromium-browser-continuous/Win/LAST_CHANGE"</span></span><br></pre></td></tr></table></figure><br>4.-C [NUM] 列出匹配行上下各NUM行</p>
<p>5.-b 列出之前文本总共多少byte</p>
<p>6.-c 显示符合条件的总行数</p>
<p>7.-E 采用正则表达式:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -E 'win[0-9]&#123;2&#125;'  download_chrome.sh</span></span><br><span class="line">wget -o /home/download/chome-<span class="variable">$VERSION</span> http://commondatastorage.googleapis.com/chromium-browser-continuous/W<span class="keyword">in</span>/<span class="variable">$VERSION</span>/chrome-win32.zip</span><br></pre></td></tr></table></figure><br>8.-f newfile 将匹配样式写入newfile，然后grep -f newfile data进行查找</p>
<p>9.-H 会带出匹配到的每一条记录的文件名字如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -H wget download_chrome.sh wget	</span></span><br><span class="line">download_chrome.sh:wget -o /home/download/chome-<span class="variable">$VERSION</span> http://commondatastorage.googleapis.com/chromium-browser-continuous/W<span class="keyword">in</span>/<span class="variable">$VERSION</span>/chrome-win32.zip</span><br><span class="line">wget:wget -o /home/download/chome-<span class="variable">$VERSION</span> http://commondatastorage.googleapis.c</span><br></pre></td></tr></table></figure><br>10.-i 忽略大小写</p>
<p>11.-L 不显示出符合匹配的文件名称</p>
<p>12.-l 显示出符合匹配的文件名称</p>
<p>13.-n 标注当前行号</p>
<p>14.-r 递归的读出所有资料下的所有档案</p>
<p>15.-v 显示出了搜寻样式之外的全部:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -v wget download_chrome.sh | grep VERSION</span></span><br><span class="line">VERSION=<span class="string">"curl http://commondatastorage.googleapis.com/chromium-browser-continuous/Win/LAST_CHANGE"</span></span><br></pre></td></tr></table></figure><br>16.-w 将搜寻样式视为一个字去搜索</p>
<p>17.-x 将搜索样式视为一整行去搜索</p>
<p>18.匹配特殊字符比如<code>strategyId\&quot;:110</code>这样，需要将特殊字符转义<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'strategyId\\\":110'</span></span><br></pre></td></tr></table></figure> </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python/2013-04-22-python-django" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/22/python/2013-04-22-python-django/" class="article-date">
  	<time datetime="2013-04-21T16:00:00.000Z" itemprop="datePublished">2013-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/22/python/2013-04-22-python-django/">搭建简易web框架django</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/django/">django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Kenshin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>