<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Kenshin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Kenshin">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Kenshin">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kenshin">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Kenshin" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/author.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Kenshin</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="GitHub" target="_blank" href="https://github.com/gayyzxyx" title="GitHub">GitHub</a>
					        
								<a class="Email" target="_blank" href="/yao.rid@gmail.com" title="Email">Email</a>
					        
								<a class="LinkedIn" target="_blank" href="https://www.linkedin.com/in/xin-yao-713b2b78" title="LinkedIn">LinkedIn</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BIO/" style="font-size: 13.33px;">BIO</a> <a href="/tags/ConcurrentModificationException/" style="font-size: 10px;">ConcurrentModificationException</a> <a href="/tags/NIO/" style="font-size: 13.33px;">NIO</a> <a href="/tags/Netty/" style="font-size: 16.67px;">Netty</a> <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/awk/" style="font-size: 13.33px;">awk</a> <a href="/tags/bottle/" style="font-size: 10px;">bottle</a> <a href="/tags/crack/" style="font-size: 10px;">crack</a> <a href="/tags/date/" style="font-size: 10px;">date</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/maketrans/" style="font-size: 10px;">maketrans</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/pptp/" style="font-size: 10px;">pptp</a> <a href="/tags/putty/" style="font-size: 10px;">putty</a> <a href="/tags/python/" style="font-size: 16.67px;">python</a> <a href="/tags/reflection/" style="font-size: 10px;">reflection</a> <a href="/tags/sed/" style="font-size: 13.33px;">sed</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/shell/" style="font-size: 20px;">shell</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/sublime-text2/" style="font-size: 10px;">sublime text2</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/translate/" style="font-size: 10px;">translate</a> <a href="/tags/vpn/" style="font-size: 10px;">vpn</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Kenshin</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/author.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Kenshin</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="GitHub" target="_blank" href="https://github.com/gayyzxyx" title="GitHub">GitHub</a>
			        
						<a class="Email" target="_blank" href="/yao.rid@gmail.com" title="Email">Email</a>
			        
						<a class="LinkedIn" target="_blank" href="https://www.linkedin.com/in/xin-yao-713b2b78" title="LinkedIn">LinkedIn</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-other/2015-12-18-vpn" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/18/other/2015-12-18-vpn/" class="article-date">
  	<time datetime="2015-12-17T16:00:00.000Z" itemprop="datePublished">2015-12-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/18/other/2015-12-18-vpn/">搭梯子姿势界定</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="shadowsocks"><a href="#shadowsocks" class="headerlink" title="shadowsocks"></a>shadowsocks</h2><p>受够了GFW的孽性，忍无可忍之下强迫自建梯子。买的conoha的vps，但是发现用它在搭建pptp服务的时候，一直连不上，错误的log如下：</p>
<pre><code>Dec 18 12:09:18 133-130-xx-xxx pptpd[6401]: CTRL: Client 120.132.35.131 control connection started
Dec 18 12:09:18 133-130-xx-xxx pptpd[6401]: CTRL: Starting call (launching pppd, opening GRE)
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: Plugin /usr/lib/pptpd/pptpd-logwtmp.so loaded.
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: pppd 2.4.6 started by root, uid 0
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: Using interface ppp0
Dec 18 12:09:18 133-130-xx-xxx pppd[6402]: Connect: ppp0 &lt;--&gt; /dev/pts/2
Dec 18 12:09:18 133-130-xx-xxx pptpd[6401]: GRE: Bad checksum from pppd.
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: LCP: timeout sending Config-Requests
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: Connection terminated.
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: Modem hangup
Dec 18 12:09:48 133-130-xx-xxx pppd[6402]: Exit.
</code></pre><p>google下发现原来我不是一个人:<br><img src="/img/other/pptp_error_1.jpeg" alt="sign" width="100%"><br>原因推测是GRE协议被<code>conoha</code>封锁，没办法只好换成Shadowsocks。</p>
<p>1.安装依赖包<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install build-essential autoconf libtool libssl-dev gawk debhelper git</span><br></pre></td></tr></table></figure><br>2.下载源码<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/madeye/shadowsocks-libev.git</span><br></pre></td></tr></table></figure><br>3.直接安装<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> shadowsocks-libev &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><br>4.配置文件修改</p>
<pre><code>{
    &quot;server&quot;:&quot;0.0.0.0&quot;,             #服务端监听地址(IPv4或IPv6)
    &quot;server_port&quot;:8388,             #服务端端口，一般默认8388
    &quot;local_address&quot;:&quot;127.0.0.1&quot;,    #本地监听地址，缺省为127.0.0.1
    &quot;local_port&quot;:1080,              #本地监听端口，一般为1080
    &quot;password&quot;:&quot;password&quot;,          #用以加密的密匙   
    &quot;timeout&quot;:600,                  #超时时间（秒）
    &quot;method&quot;:&quot;aes-256-cfb&quot;          #加密方式，选择aes-256-cfb安全性较强
}
</code></pre><p>5.启动<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/shadowsocks start</span><br></pre></td></tr></table></figure></p>
<h2 id="socks5"><a href="#socks5" class="headerlink" title="socks5"></a>socks5</h2><p>也可以通过ssh端口转发，系统设置socks5代理<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -N -D <span class="number">7070</span> root@<span class="number">133.130</span>.<span class="number">57.222</span></span><br></pre></td></tr></table></figure><br>然后在系统代码的地方设置socks5,连接本地ip:port,如127.0.0.1:7070<br><img src="/img/other/socks5.jpg" alt="socks5" width="100%"><br>这样就可以愉快上网了，通过chrome插件可以实现自动代理。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pptp/">pptp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shadowsocks/">shadowsocks</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vpn/">vpn</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/other/">other</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2014-02-27-linux-date-syn" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/02/27/shell/2014-02-27-linux-date-syn/" class="article-date">
  	<time datetime="2014-02-26T16:00:00.000Z" itemprop="datePublished">2014-02-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/02/27/shell/2014-02-27-linux-date-syn/">解决debian时间差8小时</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.更改时区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Asia/Shanghai"</span> &gt; /etc/timezone</span><br></pre></td></tr></table></figure>

2\.根据时区覆盖原有的localtime文件

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/localtime /etc/localtime.bak</span><br><span class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/</span><br><span class="line">mv /etc/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<p>3.查看rcS文件中是否有UTC</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/default/rcS</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"UTC=no"</span> &gt;&gt; /etc/default/rcS</span><br></pre></td></tr></table></figure>
<p>4.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ntpdate</span><br></pre></td></tr></table></figure></p>
<p>5.更新时间<code>ntpdate ntp.fudan.edu.cn</code> ,如果提示错误，执行<code>service ntp stop</code>, 然后<code>ntpdate ntp.fudan.edu.cn</code>，然后date看下时间就妥妥的了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/date/">date</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python/2013-10-06-file-synchronise" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/10/06/python/2013-10-06-file-synchronise/" class="article-date">
  	<time datetime="2013-10-05T16:00:00.000Z" itemprop="datePublished">2013-10-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/06/python/2013-10-06-file-synchronise/">文件同步</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有时候需要用到文件同步将本地文件与远程文件保持一致，可以是全量的，也可以是增量的，于是用py简单撸了下。简单来说就是遍历当前文件夹，如果当前是文件则检测目标文件夹中是否存在该文件，不存在就复制；如果检测到的是文件夹，则递归检测子文件夹，核心如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Syn</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dPath)</span>:</span></span><br><span class="line">        self.sPath = os.getcwd()</span><br><span class="line">        self.dPath = dPath</span><br><span class="line">        self.absFolder = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copyFile</span><span class="params">(self, path)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(os.path.join(path, i)):</span><br><span class="line">                sourceFile = os.path.join(os.path.join(self.sPath, self.absFolder), i)</span><br><span class="line">                targetFile = os.path.join(os.path.join(self.dPath , self.absFolder), i)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> (os.path.exists(targetFile) <span class="keyword">and</span> os.path.getsize(targetFile) == os.path.getsize(sourceFile)):</span><br><span class="line">                    open(targetFile, <span class="string">"wb"</span>).write(open(sourceFile, <span class="string">"rb"</span>).read())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                targetPath = os.path.join(os.path.join(self.dPath, self.absFolder), i)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(targetPath):</span><br><span class="line">                    self.absFolder = os.path.join(self.absFolder, i)</span><br><span class="line">                    os.makedirs(targetPath)</span><br><span class="line">                    self.copyFile(os.path.join(self.sPath, self.absFolder))</span><br><span class="line">                    self.absFolder = os.path.split(self.absFolder)[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.absFolder = os.path.join(self.absFolder, i)</span><br><span class="line">                    self.copyFile(os.path.join(self.sPath, self.absFolder))</span><br><span class="line">                    self.absFolder = os.path.split(self.absFolder)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>对了全量同步，只需要在同步前把目标文件夹给删除掉。在程序运行前带入参数。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">   target = sys.argv[<span class="number">2</span>].decode(<span class="string">"utf-8"</span>).encode(<span class="string">"gbk"</span>)</span><br><span class="line">   <span class="keyword">if</span> sys.argv[<span class="number">1</span>]==<span class="string">"all"</span>:</span><br><span class="line">       <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(target):</span><br><span class="line">           <span class="keyword">try</span>:</span><br><span class="line">               <span class="keyword">if</span> os.path.isfile(os.path.join(target, file)):</span><br><span class="line">                   os.remove(os.path.join(target, file))</span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   os.system(<span class="string">'rd /S /Q %s'</span>% os.path.join(target, file))</span><br><span class="line">           <span class="keyword">except</span> Exception,e:</span><br><span class="line">               <span class="keyword">print</span> e, file</span><br><span class="line">   syn = Syn(target)</span><br><span class="line">   syn.copyFile(os.getcwd())</span><br><span class="line">   <span class="keyword">print</span> <span class="string">"success"</span></span><br></pre></td></tr></table></figure>
<p>核心代码不超过20行，但是为日常应用带来了很大的方便。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-09-03-sort-uniq-join-tr" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/09/03/shell/2013-09-03-sort-uniq-join-tr/" class="article-date">
  	<time datetime="2013-09-02T16:00:00.000Z" itemprop="datePublished">2013-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/09/03/shell/2013-09-03-sort-uniq-join-tr/">关于文件基本处理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>文件处理围绕着sort、uniq、join、cut、paste、split、tr、tar等命令，这些与sed和awk组合起来构成了linux文本处理的所有命令和工具。</p>
<h2 id="1-sort_u547D_u4EE4"><a href="#1-sort_u547D_u4EE4" class="headerlink" title="1.sort命令"></a>1.sort命令</h2><p>sort命令将输入文件看成是有多条记录组成的数据流，记录由可变宽度的字符组成，以换行符作为界定符。其与awk命令一样，也可以指令域分隔符，不一样的是sort的分割符是-t选项，而awk是F。sort的常用选项如下：</p>
<table class="table table-bordered table-striped"><tr><td>选项</td><td>意义</td></tr><tr><td>-c</td><td>测试文件是否已经被排序</td></tr><tr><td>-k</td><td>指定排序的域</td></tr><tr><td>-m</td><td>合并两个已排序的文件</td></tr><tr><td>-n</td><td>根据数字大小进行排序</td></tr><tr><td>-o[输出文件</td><td>重定向</td></tr><tr><td>-r</td><td>将排序结果逆向显示</td></tr><tr><td>-t</td><td>改变域分隔符</td></tr><tr><td>-u</td><td>去除结果中的重复行</td></tr><br></table>

<h3 id="1-1-t_u9009_u9879"><a href="#1-1-t_u9009_u9879" class="headerlink" title="1.1.-t选项"></a>1.1.-t选项</h3><p>sort的默认分隔符是空格，在t后面紧跟分割符号就可以指定域</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db</span></span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line"></span><br><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t:  #指定分隔符:后</span></span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br></pre></td></tr></table></figure>
<h3 id="1-2-k_u9009_u9879"><a href="#1-2-k_u9009_u9879" class="headerlink" title="1.2.-k选项"></a>1.2.-k选项</h3><p>sort默认是按第一个域进行排序的，可以指定第n个域进行排序如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t: -k2</span></span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br></pre></td></tr></table></figure>
<h3 id="1-3-n_u9009_u9879"><a href="#1-3-n_u9009_u9879" class="headerlink" title="1.3.-n选项"></a>1.3.-n选项</h3><p>-n表示按数字大小进行排序。如果不指定-n选项，在排序的时候默认按当前域的字符序列进行排序，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t: -k3n</span></span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br></pre></td></tr></table></figure>
<h3 id="1-4-r_u9009_u9879"><a href="#1-4-r_u9009_u9879" class="headerlink" title="1.4.-r选项"></a>1.4.-r选项</h3><p>-r用于将排序的结果逆向显示，如果要按数值降序可按如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db|sort -t: -k3nr</span></span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br></pre></td></tr></table></figure>
<h3 id="1-5-u_u9009_u9879"><a href="#1-5-u_u9009_u9879" class="headerlink" title="1.5.-u选项"></a>1.5.-u选项</h3><p>-u用于去除重复选行，在上面文件中加入几个重复行，用-u过滤后如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db |sort -t: -u</span></span><br><span class="line">Acer:Taiwan:<span class="number">8000</span>:<span class="number">2000</span>:PT210</span><br><span class="line">HP:China:<span class="number">12000</span>:<span class="number">2010</span>:NE808</span><br><span class="line">HP:China:<span class="number">5600</span>:<span class="number">2010</span>:DM3</span><br><span class="line">IdeaPad:China:<span class="number">8000</span>:<span class="number">2007</span>:U450</span><br><span class="line">SumSung:Korea:<span class="number">5400</span>:<span class="number">2009</span>:Q308</span><br><span class="line">thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br><span class="line">thinkpad:USA:<span class="number">14000</span>:<span class="number">2009</span>:x301</span><br><span class="line">thinkpad:USA:<span class="number">8000</span>:<span class="number">2007</span>:x60</span><br></pre></td></tr></table></figure>
<h3 id="1-6-o_u9009_u9879"><a href="#1-6-o_u9009_u9879" class="headerlink" title="1.6.-o选项"></a>1.6.-o选项</h3><p>一般用sort排序后都是将结果直接输出到屏幕或者管道，也可以直接输出到文件，跟IO重定向一个效果。如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># cat computer.db |sort -t: -u -o com1.db</span></span><br></pre></td></tr></table></figure>
<h3 id="1-7-c_u7528_u4E8E_u6D4B_u8BD5_u6587_u4EF6_u662F_u5426_u5DF2_u7ECF_u6392_u597D_u5E8F"><a href="#1-7-c_u7528_u4E8E_u6D4B_u8BD5_u6587_u4EF6_u662F_u5426_u5DF2_u7ECF_u6392_u597D_u5E8F" class="headerlink" title="1.7.-c用于测试文件是否已经排好序"></a>1.7.-c用于测试文件是否已经排好序</h3><p>刚刚的com1.db是已经排好序的文件，测试如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># sort -t: -c com1.db</span></span><br><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>如果没有排好序结果如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/home/pi/exercise<span class="comment"># sort -t: -c computer.db</span></span><br><span class="line">sort: computer.db:<span class="number">2</span>: disorder: thinkpad:HongKong:<span class="number">10000</span>:<span class="number">2008</span>:T400</span><br></pre></td></tr></table></figure>
<h3 id="1-8-_u5C06_u6392_u597D_u5E8F_u7684_u4E24_u4E2A_u6587_u4EF6_u5408_u5E76_u6210_u4E00_u4E2A_u524D_u63D0_u662F_u4E24_u4E2A_u6587_u4EF6_u90FD_u5FC5_u987B_u662F_u5DF2_u7ECF_u6392_u597D_u5E8F_u7684"><a href="#1-8-_u5C06_u6392_u597D_u5E8F_u7684_u4E24_u4E2A_u6587_u4EF6_u5408_u5E76_u6210_u4E00_u4E2A_u524D_u63D0_u662F_u4E24_u4E2A_u6587_u4EF6_u90FD_u5FC5_u987B_u662F_u5DF2_u7ECF_u6392_u597D_u5E8F_u7684" class="headerlink" title="1.8.将排好序的两个文件合并成一个前提是两个文件都必须是已经排好序的"></a>1.8.将排好序的两个文件合并成一个前提是两个文件都必须是已经排好序的</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python/2013-08-10-add-screen-forpi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/08/10/python/2013-08-10-add-screen-forpi/" class="article-date">
  	<time datetime="2013-08-09T16:00:00.000Z" itemprop="datePublished">2013-08-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/10/python/2013-08-10-add-screen-forpi/">给树莓派添加显示屏</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>给树莓派添加一个外部的黑白屏用于显示运行状态，包括温度，内存，cpu使用，ip地址等等，屏幕用诺基亚5100的拆机屏。需要用到一个函数库，在Raspberry Pi的讨论区中已经有人共享了成果<a href="http://www.raspberrypi.org/phpBB3/download/file.php?id=2239&amp;sid=54ab6c13f737d4df57d295afa8bf3752" target="_blank" rel="external">nokimagpi.tar.gz</a>。由于这个程序用到一些modules，需要装一些环境支持:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-dev</span><br><span class="line">sudo apt-get install python-pip</span><br><span class="line">sudo pip install wiringpi</span><br><span class="line">sudo pip install spidev</span><br><span class="line">sudo pip install pil</span><br></pre></td></tr></table></figure>
<p>5100显示屏的针脚定义从左到右依次是：RST,CE,DC(D/C),Din(DNK),Clk(SCLK),Vcc,BL(LED),Gnd,总共8根线，将其连接到树莓派的gpio口，对应关系如下(将pi的网口端正对自己，从左往右，依次向下分别为pin 1 2 3…)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RST ←→ pin <span class="number">11</span></span><br><span class="line">CE (SCE) ←→ pin <span class="number">24</span></span><br><span class="line">DC (D/C)  ←→ pin <span class="number">15</span></span><br><span class="line">Din (DNK) ←→ pin <span class="number">19</span></span><br><span class="line">Clk (SCLK) ←→ pin <span class="number">23</span></span><br><span class="line">Vcc  ←→ pin <span class="number">1</span></span><br><span class="line">BL(LED) ←→ pin <span class="number">12</span></span><br><span class="line">Gnd  ←→ pin <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>接下来写脚本调用<code>nokiaSPI.py</code>控制屏幕输出，常用的方法如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nokia.cls()：清除显示</span><br><span class="line">nokia.gotoxy(x, y)：將游标移动到 x, y 指定的位置。</span><br><span class="line">nokia.text(<span class="string">"英文字串"</span>)：在目前的屏幕中显示英文字符。</span><br><span class="line">nokia.led(<span class="number">0</span>)：关闭背光</span><br></pre></td></tr></table></figure>
<p>需要用到显示相关信息的方法如下，获取内存和CPU占用需要用到psutil包：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取IP地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getIp</span><span class="params">()</span>:</span></span><br><span class="line">    ipAdd = commands.getstatusoutput(<span class="string">"ifconfig|grep 'inet addr:'|grep -v '127.0.0.1'|awk '&#123;print $2&#125;'|awk -F':' '&#123;print $2&#125;'"</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> ipAdd</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取温度信息</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTempurature</span><span class="params">()</span>:</span></span><br><span class="line">	tempurature = str(string.atoi(commands.getstatusoutput(<span class="string">"cat /sys/class/thermal/thermal_zone0/temp"</span>)[<span class="number">1</span>])/<span class="number">1000.0</span>)</span><br><span class="line">	<span class="keyword">return</span> tempurature</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取CPU占用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCpuUseage</span><span class="params">()</span>:</span></span><br><span class="line">	cpu = <span class="string">"cpu:"</span>+str(psutil.cpu_percent(<span class="number">0.1</span>))+<span class="string">"%"</span></span><br><span class="line">    <span class="keyword">return</span> cpu</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取内存占用情况</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getMem</span><span class="params">()</span>:</span></span><br><span class="line">    phymem = psutil.phymem_usage()</span><br><span class="line">    buffers = getattr(psutil, <span class="string">'phymem_buffers'</span>, <span class="keyword">lambda</span>: <span class="number">0</span>)()</span><br><span class="line">    cached = getattr(psutil, <span class="string">'cached_phymem'</span>, <span class="keyword">lambda</span>: <span class="number">0</span>)()</span><br><span class="line">    used = phymem.total - (phymem.free + buffers + cached)</span><br><span class="line">    line = <span class="string">"Mem:%s/%s"</span> % (</span><br><span class="line">        str(int(used / <span class="number">1024</span> / <span class="number">1024</span>)) + <span class="string">"M"</span>,</span><br><span class="line">        str(int(phymem.total / <span class="number">1024</span> / <span class="number">1024</span>)) + <span class="string">"M"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> line</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取开机运行时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUpTime</span><span class="params">()</span>:</span></span><br><span class="line">    time = commands.getstatusoutput(<span class="string">"uptime|awk -F',' '&#123;print $1&#125;'|awk '&#123;print $3&#125;'"</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> time</span><br></pre></td></tr></table></figure>
<p>运行后的效果<br><img src="/img/pi/screen.jpg" alt="sign"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-07-14-Nginx-MultiPort" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/07/14/shell/2013-07-14-Nginx-MultiPort/" class="article-date">
  	<time datetime="2013-07-13T16:00:00.000Z" itemprop="datePublished">2013-07-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/07/14/shell/2013-07-14-Nginx-MultiPort/">使用nginx解决BOTTLE单例</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>bottle的单例访问让人蛋疼，本来就不高的并发，为了解决这种问题想到了nginx代理多端口转发。首先在程序里面将端口改成动态传入,在main.py中修改：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">args = sys.argv</span><br><span class="line"><span class="comment">#默认args[0]是文件的名字 args[1],[2]等依次是后面跟着的参数</span></span><br><span class="line">port = string.atoi(args[<span class="number">1</span>])  </span><br><span class="line">. </span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">run(app,host=host,port=port)</span><br></pre></td></tr></table></figure><br>启动实例的端口由shell脚本带入，需要再次写以下脚本，表示根据shell带进的入参，依次启动实例：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"> </span></span><br><span class="line"> <span class="built_in">cd</span> /home/pi/gayyzxyx-manage/gayyzxyx-manage-<span class="number">8080</span>/</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> [ <span class="variable">$#</span> = <span class="number">0</span> ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"pls input ports"</span></span><br><span class="line">     <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"> file=main.py</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> [ ! <span class="operator">-f</span> <span class="variable">$file</span> ]; <span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"main.py does't exist"</span></span><br><span class="line">     <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">for</span> port <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">     python main.py <span class="variable">$port</span>&gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure><br>接着修改nginx动态代理如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">upstream bottle&#123;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span>;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span>;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8082</span>;</span><br><span class="line">           server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8083</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       charset        utf-<span class="number">8</span>;</span><br><span class="line">       server &#123;</span><br><span class="line">           listen       <span class="number">80</span>;</span><br><span class="line">           server_name  localhost;</span><br><span class="line">   </span><br><span class="line">           <span class="preprocessor">#charset koi8-r;</span></span><br><span class="line">   </span><br><span class="line">           <span class="preprocessor">#access_log  logs/host.access.log  main;</span></span><br><span class="line">   </span><br><span class="line">           location / &#123;</span><br><span class="line">               <span class="preprocessor">#root   html;</span></span><br><span class="line">               <span class="preprocessor">#index  index.html index.htm;</span></span><br><span class="line">               proxy_pass              http:<span class="comment">//bottle;</span></span><br><span class="line">               proxy_set_header        Host             $host;</span><br><span class="line">               proxy_set_header        X-Real-IP        $remote_addr;</span><br><span class="line">               proxy_set_header        X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">           &#125;</span><br><span class="line">           .</span><br><span class="line">           .</span><br><span class="line">           .</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><br>其中在upstream中加入需要启动实例的ip:port，在上面的shell脚本中写了几个就需要在这里配置几个，至此基本上配置完成。先通过./xx.sh 8080 8081 8082 8083先启动实例，查看进程会发现如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@raspberrypi:/usr/<span class="built_in">local</span>/nginx/<span class="number">1.4</span>.<span class="number">1</span><span class="comment"># ps -ef | grep python | grep -v grep</span></span><br><span class="line">root     <span class="number">19567</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span> python main.py <span class="number">8080</span></span><br><span class="line">root     <span class="number">19568</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span> python main.py <span class="number">8081</span></span><br><span class="line">root     <span class="number">19569</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">02</span> python main.py <span class="number">8082</span></span><br><span class="line">root     <span class="number">19570</span>     <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">37</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">04</span> python main.py <span class="number">8083</span></span><br></pre></td></tr></table></figure><br>接着启动nginx,在远程电脑上访问192.168.1.105，可以发现每个实例都有转发内容 </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bottle/">bottle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-06-18-grep" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/06/18/shell/2013-06-18-grep/" class="article-date">
  	<time datetime="2013-06-17T16:00:00.000Z" itemprop="datePublished">2013-06-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/06/18/shell/2013-06-18-grep/">LINUX下GREP简易用法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Usage: grep [OPTION]… PATTERN [FILE]…Search for PATTERN in each FILE or standard input.PATTERN is, by default, a basic regular expression (BRE).Example: grep -i ‘hello world’ menu.h main.c</strong></p>
<p>1.-A NUM 显示匹配行下的NUM行:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -A 1 bash download_chrome.sh</span></span><br><span class="line">!bin/bash</span><br><span class="line">VERSION=<span class="string">"curl http://commondatastorage.googleapis.com/chromium-browser-continuous/Win/LAST_CHANGE"</span></span><br></pre></td></tr></table></figure><br>2.-a 搜寻二进制档案中文本</p>
<p>3.-B NUM 显示匹配行以上的NUM行:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -B 1 VERSION download_chrome.sh</span></span><br><span class="line">!bin/bash</span><br><span class="line">VERSION=<span class="string">"curl http://commondatastorage.googleapis.com/chromium-browser-continuous/Win/LAST_CHANGE"</span></span><br></pre></td></tr></table></figure><br>4.-C [NUM] 列出匹配行上下各NUM行</p>
<p>5.-b 列出之前文本总共多少byte</p>
<p>6.-c 显示符合条件的总行数</p>
<p>7.-E 采用正则表达式:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -E 'win[0-9]&#123;2&#125;'  download_chrome.sh</span></span><br><span class="line">wget -o /home/download/chome-<span class="variable">$VERSION</span> http://commondatastorage.googleapis.com/chromium-browser-continuous/W<span class="keyword">in</span>/<span class="variable">$VERSION</span>/chrome-win32.zip</span><br></pre></td></tr></table></figure><br>8.-f newfile 将匹配样式写入newfile，然后grep -f newfile data进行查找</p>
<p>9.-H 会带出匹配到的每一条记录的文件名字如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -H wget download_chrome.sh wget	</span></span><br><span class="line">download_chrome.sh:wget -o /home/download/chome-<span class="variable">$VERSION</span> http://commondatastorage.googleapis.com/chromium-browser-continuous/W<span class="keyword">in</span>/<span class="variable">$VERSION</span>/chrome-win32.zip</span><br><span class="line">wget:wget -o /home/download/chome-<span class="variable">$VERSION</span> http://commondatastorage.googleapis.c</span><br></pre></td></tr></table></figure><br>10.-i 忽略大小写</p>
<p>11.-L 不显示出符合匹配的文件名称</p>
<p>12.-l 显示出符合匹配的文件名称</p>
<p>13.-n 标注当前行号</p>
<p>14.-r 递归的读出所有资料下的所有档案</p>
<p>15.-v 显示出了搜寻样式之外的全部:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/download<span class="comment"># grep -v wget download_chrome.sh | grep VERSION</span></span><br><span class="line">VERSION=<span class="string">"curl http://commondatastorage.googleapis.com/chromium-browser-continuous/Win/LAST_CHANGE"</span></span><br></pre></td></tr></table></figure><br>16.-w 将搜寻样式视为一个字去搜索</p>
<p>17.-x 将搜索样式视为一整行去搜索</p>
<p>18.匹配特殊字符比如<code>strategyId\&quot;:110</code>这样，需要将特殊字符转义<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'strategyId\\\":110'</span></span><br></pre></td></tr></table></figure> </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python/2013-04-22-python-django" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/22/python/2013-04-22-python-django/" class="article-date">
  	<time datetime="2013-04-21T16:00:00.000Z" itemprop="datePublished">2013-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/22/python/2013-04-22-python-django/">搭建简易web框架django</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/django/">django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/python/">python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shell/2013-03-02-Awk" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/03/02/shell/2013-03-02-Awk/" class="article-date">
  	<time datetime="2013-03-01T16:00:00.000Z" itemprop="datePublished">2013-03-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/03/02/shell/2013-03-02-Awk/">文本处理神器sed与awk命令使用(续)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>上一篇<a href="/2013/02/24/shell/2013-02-24-Sed-And-Awk/">传送门</a></p>
<h2 id="u6982_u8FF0_uFF1A"><a href="#u6982_u8FF0_uFF1A" class="headerlink" title="概述："></a>概述：</h2><p>awk功能与sed相似，都是处理文本的工具，但是awk的强大之处在于借助强大的语法支持处理格式化的文本，在处理没有规律的文本上面不及sed方便，术业有专攻吧。</p>
<h2 id="awk_u7F16_u7A0B_u6A21_u578B_3A"><a href="#awk_u7F16_u7A0B_u6A21_u578B_3A" class="headerlink" title="awk编程模型:"></a>awk编程模型:</h2><p>awk不能看作是一个shell命令了，更应该是一门编程语言。awk程序由一个主输入循环维持，其反复执行直到终止条件被触发。幸运的是awk的主循环框架无需我们去编写，已经搭建好了，我们只需要将写好的代码嵌入到循环框架中执行。awk有两个特殊的字段：BEGIN和END，BEGIN在主输入循环之前执行，即在未读取输入文件之前执行，END则恰好相反。总体看，awk程序的执行分为三个阶段：读输入文件之前的执行代码段（由BEGIN关键字标识）、读取输入文件时的执行代码段、读取输入文件之后的执行代码段（由END关键字标志）。</p>
<h2 id="awk_u7684_u8C03_u7528_u65B9_u6CD5_uFF1A"><a href="#awk_u7684_u8C03_u7528_u65B9_u6CD5_uFF1A" class="headerlink" title="awk的调用方法："></a>awk的调用方法：</h2><p>调用awk的方法与调用sed类似，也有三种方式：</p>
<p>1.在shell命令行输入命令调用awk，格式为    </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [-F 域分隔符] <span class="string">'awk程序段'</span> 输入文件   <span class="comment">#需要用单引号将awk程序段引起来</span></span><br></pre></td></tr></table></figure>

2\.将awk程序段插入脚本文件，然后通过awk命令调用它，格式为

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="operator">-f</span> awk脚本文件 输入文件     <span class="comment">#同sed命令类似也是通过-f选项表示调用脚本文件</span></span><br></pre></td></tr></table></figure>
<p>3.将sed命令插入脚本文件之后，最常用的方法是设置改脚本可执行，然后直接直接执行该脚本文件，格式为</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./awk脚本文件 输入文件     <span class="comment">#同样以#/awk路径来开头</span></span><br></pre></td></tr></table></figure>

### 1\.awk模式匹配

任何awk语句都是由模式(pattern)和动作(action)构成，模式测试输入行是否需要执行动作的规则(决定动作何时触发和触发事件)，动作是包含语句、函数和表达式的执行过程(执行对输入行的处理)，awk不仅支持所有正则表达式的元字符还支持"?"和"+"两个扩展元字符，而grep和sed并不支持，看awk的三种调用方法。

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk '/^$/&#123;print "this is a blank line."&#125;' input    #方法一调用awk打印空白行</span></span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># cat &amp;gt; scr.awk   #创建scr.awk，执行命令</span></span><br><span class="line">/^$/&#123;<span class="built_in">print</span> <span class="string">"this is a blank line."</span>&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># awk -f scr.awk input   #方法二调用awk打印空白行</span></span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># cat  scr1.awk      #创建脚本</span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">/^$/&#123;<span class="built_in">print</span> <span class="string">"this is a blank line."</span>&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># chmod u+x scr1.awk    #赋予可执行权限</span></span><br><span class="line">root@core /home/awk<span class="comment"># ./scr1.awk input     #方法三调用awk打印空白行</span></span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br><span class="line">this is a blank line.</span><br></pre></td></tr></table></figure>
<h3 id="2-_u8BB0_u5F55_u548C_u57DF"><a href="#2-_u8BB0_u5F55_u548C_u57DF" class="headerlink" title="2.记录和域"></a>2.记录和域</h3><p>awk认为输入文件是结构化的，将每个输入行定义为记录，行中每一个字符串定义为域，域之间用空格、tab键或者其他符号进行分割。awk定义$来指定执行动作的域，如$1表示第一个域，$2表示第二个，$0则表示所有的域。有一个stu记录了学生信息，有四个域，分别用空格、tab、tab隔开如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk '&#123;print $2,$1,$3,$4&#125;' stu   #依次打印第二个。第一个、第三个、第四个域</span></span><br><span class="line">Hao Li njue <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Ju Zhang nju <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">B<span class="keyword">in</span> Wang seu <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">L<span class="keyword">in</span> Zhu njupt <span class="number">025</span>-<span class="number">83680010</span></span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># awk '&#123;print $0&#125;' stu         #$0表示打印所有域</span></span><br><span class="line">Li Hao  njue    <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju        nju     <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>        seu     <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span> njupt   <span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>域操作符后面可以跟变量或者运算表达式，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;one=1;two=2&#125;&#123;print $(one+two)&#125;' stu   #打印第三个域</span></span><br><span class="line">njue</span><br><span class="line">nju</span><br><span class="line">seu</span><br><span class="line">njupt</span><br></pre></td></tr></table></figure>
<p>可以用awk的<code>-F</code>选项来改变分隔符，awk的默认设置的分隔符是空格键，而tab键是被当做连续的空格符来处理。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk -F"\t" '&#123;print $3&#125;' stu    #此时的第三个域则是电话号码那列</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line"><span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>awk还可以有另外一种方式来改变分隔符，那就是awk的环境变量FS，通过在BEGIN字段中设置FS值来改变分隔符。将stu记录中的tab制表符换成逗号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># sed 's/\t/,/g' stu &amp;gt; stu1</span></span><br><span class="line">root@core /home/awk<span class="comment"># mv stu1 stu</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;FS=","&#125;&#123;print $0&#125;' stu              #打印替换后的结果</span></span><br><span class="line">Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>另外，可以利用正则表达式将分隔符设置为多个字符，如下:<br>(1)FS=”\t”<br>(2)FS=”\t+”<br>对于记录 wza\t\tcq，第一种将会把该记录解析为三个域：wza、空域、cq，第二种将其解析为两个域：wza和cq</p>
<h3 id="3-_u5173_u7CFB_u548C_u5E03_u5C14_u8FD0_u7B97_u7B26"><a href="#3-_u5173_u7CFB_u548C_u5E03_u5C14_u8FD0_u7B97_u7B26" class="headerlink" title="3.关系和布尔运算符"></a>3.关系和布尔运算符</h3><p>awk定义了一组关系运算符用于awk模式匹配，如下表：</p>
<table class="table table-bordered table-striped"><tr><td>运算符</td><td>意义</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>==</td><td>等于</td></tr><tr><td>!=</td><td>不等于</td></tr><tr><td>~</td><td>匹配正则表达式</td></tr><tr><td>!~</td><td>不匹配正则表达式</td></tr><br></table>

<p>在/etc/passwd文件中存放了用户关键信息，以这个文件作为输入文件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; $1~/root/' /etc/passwd   #在第一个域中找出包含root关键字的记录</span></span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>
<p>awk在进行匹配的时候，常常使用到条件语句，awk的条件语句跟C语言的类似，有if、if/else、if/else else语句，如要匹配第三个域小于第四个的记录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; &#123;if($3&amp;lt;$4) print $0&#125;' /etc/passwd</span></span><br><span class="line">sync:x:<span class="number">4</span>:<span class="number">65534</span>:sync:/bin:/bin/sync</span><br><span class="line">games:x:<span class="number">5</span>:<span class="number">60</span>:games:/usr/games:/bin/sh</span><br><span class="line">man:x:<span class="number">6</span>:<span class="number">12</span>:man:/var/cache/man:/bin/sh</span><br><span class="line">libuuid:x:<span class="number">100</span>:<span class="number">101</span>::/var/lib/libuuid:/bin/sh</span><br><span class="line">ntp:x:<span class="number">101</span>:<span class="number">103</span>::/home/ntp:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:<span class="number">102</span>:<span class="number">65534</span>::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">shellinabox:x:<span class="number">103</span>:<span class="number">105</span>:Shell In A Box,,,:/var/lib/shellinabox:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>同C语言一样，awk也有三个逻辑运算符||、&amp;&amp;、！表示逻辑或与非:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125;&#123;if($3==10||$4==10) print $0' /etc/passwd  #匹配第三域或者第四域等于10的</span></span><br><span class="line">uucp:x:<span class="number">10</span>:<span class="number">10</span>:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125;&#123;if($3~10||$4~10) print $0&#125;' /etc/passwd    #匹配第三域或者第四域包含10的</span></span><br><span class="line">uucp:x:<span class="number">10</span>:<span class="number">10</span>:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">libuuid:x:<span class="number">100</span>:<span class="number">101</span>::/var/lib/libuuid:/bin/sh</span><br><span class="line">ntp:x:<span class="number">101</span>:<span class="number">103</span>::/home/ntp:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:<span class="number">102</span>:<span class="number">65534</span>::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">shellinabox:x:<span class="number">103</span>:<span class="number">105</span>:Shell In A Box,,,:/var/lib/shellinabox:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h3 id="4-_u8868_u8FBE_u5F0F"><a href="#4-_u8868_u8FBE_u5F0F" class="headerlink" title="4.表达式"></a>4.表达式</h3><p>与其他编程语言一样，awk表达适用于存储，操作和获取数据，一个awk表达式可由数值、字符常量、变量、操作符、函数和正则表达式自由组合而成。awk的变量只能包含数字字母和下划线，并且不能用数字开头。变量的默认数值为0，默认的字符串值为空。awk的算术运算符和其他语言基本上一样，包含<code>加(+)减(-)乘(*)除(/)模(%)乘方(^或**)变量自增(++x,x++)</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk /^$/&#123;print x+=1&#125; input   #每遇到一个空白行就加1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>向stu中加入学生的五门课的成绩，统计每个学生的平均成绩如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># cat stu                    #每个学生的各科目成绩</span></span><br><span class="line">Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line">Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line">Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line">Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># cat &amp;gt; avgscore.awk               #创建脚本，统计学生平均成绩</span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">BEGIN &#123;FS=<span class="string">","</span>&#125;</span><br><span class="line">&#123;total=<span class="variable">$4</span>+<span class="variable">$5</span>+<span class="variable">$6</span>+<span class="variable">$7</span>+<span class="variable">$8</span></span><br><span class="line">avg=total/<span class="number">5</span></span><br><span class="line"><span class="built_in">print</span> <span class="variable">$1</span>,avg&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># chmod u+x avgscore.awk            #获取可执行权限</span></span><br><span class="line">root@core /home/awk<span class="comment"># ./avgscore.awk stu                 #执行结果</span></span><br><span class="line">Li Hao <span class="number">87.4</span></span><br><span class="line">Zhang Ju <span class="number">86</span></span><br><span class="line">Wang B<span class="keyword">in</span> <span class="number">85.6</span></span><br><span class="line">Zhu L<span class="keyword">in</span> <span class="number">84</span></span><br></pre></td></tr></table></figure>
<h3 id="5-_u7CFB_u7EDF_u53D8_u91CF"><a href="#5-_u7CFB_u7EDF_u53D8_u91CF" class="headerlink" title="5.系统变量"></a>5.系统变量</h3><p>awk定义了很多内建的系统变量用于设置环境信息，这些系统变量分为两种，第一种用于改变awk的默认值，如域分隔符；第二种用于定义系统值，在处理文本的时候可以调用这些系统值，如记录中的域数量，当前记录数，当前文件名等。awk动态改变第二种系统变量的值，涉及到的变量如下：</p>
<table class="table table-bordered table-striped"><tr><td>变量名</td><td>意义</td></tr><tr><td>&amp;n</td><td>当前记录的第n个域</td></tr><tr><td>&amp;0</td><td>记录的所有域</td></tr><tr><td>ARGC=</td><td>命令行参数的数量</td></tr><tr><td>ARGIND</td><td>命令行中当前文件的位置（以0开始标号）</td></tr><tr><td>ARGV</td><td>命令行参数的数组</td></tr><tr><td>CONVFMT</td><td>数字转换格式</td></tr><tr><td>ENVIRON</td><td>环境变量关联数组</td></tr><tr><td>ERRNO</td><td>最后一个系统错误的描述</td></tr><tr><td>FILEWIDTHS</td><td>字段宽度列表，以空格键分割</td></tr><tr><td>FILENAME</td><td>当前文件名</td></tr><tr><td>FNR</td><td>浏览文件的记录数</td></tr><tr><td>FS</td><td>字段分隔符，默认是空格键</td></tr><tr><td>IGNORECASE</td><td>布尔变量，如果为真，则进行忽略大小写的匹配</td></tr><tr><td>NF</td><td>当前记录中的域数量</td></tr><tr><td>NR</td><td>当前记录数</td></tr><tr><td>OFMT</td><td>数字的输出格式</td></tr><tr><td>OFS</td><td>输出域分隔符，默认是空格键</td></tr><tr><td>ORS</td><td>输出记录分隔符，默认是换行符</td></tr><tr><td>RLENGTH</td><td>由match函数所匹配的字符串长度</td></tr><tr><td>RS</td><td>记录分隔符，默认是空格键</td></tr><tr><td>RSTART</td><td>由match函数所匹配的字符串的第一个位置</td></tr><tr><td>SUBSEP</td><td>数组下标分隔符，默认是\034</td></tr><br></table>

<p>如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;FS=","&#125;&#123;print NF,NR,$0&#125;END&#123;print FILENAME&#125;' stu</span></span><br><span class="line"><span class="number">8</span> <span class="number">1</span> Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line"><span class="number">8</span> <span class="number">2</span> Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line"><span class="number">8</span> <span class="number">3</span> Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line"><span class="number">8</span> <span class="number">4</span> Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br><span class="line">stu</span><br></pre></td></tr></table></figure>
<h3 id="6-_u683C_u5F0F_u5316_u8F93_u51FA"><a href="#6-_u683C_u5F0F_u5316_u8F93_u51FA" class="headerlink" title="6.格式化输出"></a>6.格式化输出</h3><p>print语句提供了最基本的输出格式，而awk的一大主要功能是产生报表，需要按照预定的格式输出，awk借鉴了C语言的语法，定义了printf输出语句，可以指定输出格式，基本语法如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(格式控制符，参数)</span><br></pre></td></tr></table></figure>

格式控制符都是以%符号开始，用以描述格式的规范，参数列表，比如变量名列表，与格式控制符相对应，作为输出对象。可以将格式控制符分为awk修饰符和格式符两种，如下：

<table class="table table-bordered table-striped"><tr><td>修饰符</td><td>意义</td></tr><tr><td>-</td><td>左对齐</td></tr><tr><td>width</td><td>域的步长</td></tr><tr><td>.prec</td><td>小数点右边的位数</td></tr>
</table>

<table class="table table-bordered table-striped"><tr><td>格式符</td><td>意义</td></tr><tr><td>%c</td><td>ASCII字符</td></tr><tr><td>%d</td><td>整型数</td></tr><tr><td>%e</td><td>浮点数，科学计数法</td></tr><tr><td>%f</td><td>浮点数</td></tr><tr><td>%o</td><td>八进制数</td></tr><tr><td>%s</td><td>字符串</td></tr><tr><td>%x</td><td>十六进制数</td></tr>
</table>

例如：

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=","&#125;&#123;printf("%s\t%d\n",$2,$8)&#125;' stu  #域只见用tab隔开，每输出两个换行</span></span><br><span class="line">njue    <span class="number">88</span></span><br><span class="line">nju     <span class="number">86</span></span><br><span class="line">seu     <span class="number">84</span></span><br><span class="line">njupt   <span class="number">76</span></span><br><span class="line"></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;printf("%c\n",65)&#125;'                #ASCII转换</span></span><br><span class="line">A</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;printf("%.2f\n",65.101)&#125;'          #保留两位小数，与C语言一样的语法</span></span><br><span class="line"><span class="number">65.10</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=","&#125;&#123;printf("%-15s\t%s\n",$1,$3)&#125;' stu       #控%-15s制字符串长度15位并左对齐</span></span><br><span class="line">Li Hao          <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju        <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>        <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span>         <span class="number">025</span>-<span class="number">83680010</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=",";print "Name\t\tPhoneNumber"&#125;&#123;printf("%-15s\t%s\n",$1,$3)&#125;' stu    #在begin中添加输出注释</span></span><br><span class="line">Name            PhoneNumber</span><br><span class="line">Li Hao          <span class="number">025</span>-<span class="number">83481010</span></span><br><span class="line">Zhang Ju        <span class="number">025</span>-<span class="number">83466534</span></span><br><span class="line">Wang B<span class="keyword">in</span>        <span class="number">025</span>-<span class="number">83494883</span></span><br><span class="line">Zhu L<span class="keyword">in</span>         <span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<h3 id="7-_u5185_u7F6E_u5B57_u7B26_u4E32_u51FD_u6570"><a href="#7-_u5185_u7F6E_u5B57_u7B26_u4E32_u51FD_u6570" class="headerlink" title="7.内置字符串函数"></a>7.内置字符串函数</h3><p>awk提供了强大的内置字符串函数用于实现文本的字符串替换、查找以及分隔符等功能。如下表：</p>
<table class="table table-bordered table-striped"><tr><td>函数名</td><td>意义</td></tr><tr><td>gsub(r,s)</td><td>在输入文件中用s替换r</td></tr><tr><td>gsub(r,s,t)</td><td>在t中用s替换r</td></tr><tr><td>index(s,t)</td><td>返回s字符串中第一个t的位置</td></tr><tr><td>length(s)</td><td>返回s的长度</td></tr><tr><td>match(s,t)</td><td>测试s是否包含匹配t的字符串</td></tr><tr><td>split(r,s,t)</td><td>在t上将r分成序列s</td></tr><tr><td>sub(r,s,t)</td><td>将t中第一次出现的r替换为s</td></tr><tr><td>substr(r,s)</td><td>返回字符串r中从s开始的后缀部分</td></tr><tr><td>substr(r,s,t)</td><td>返回字符串r中从s开始长度为t的后缀部分</td></tr><br></table>

<p>gsub函数提供字符串的替换功能，gsub的第一种形式作用于全部域，即$0，第二种作用于域t。如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; gsub(/root/,"gridsphere",$1) &#123;print $0&#125;' /etc/passwd  #替换第一个域上的root字符串</span></span><br><span class="line">gridsphere x <span class="number">0</span> <span class="number">0</span> root /root /bin/bash</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;FS=":"&#125; gsub(/root/,"gridsphere") &#123;print $0&#125;' /etc/passwd    #替换全部域上的root字符串</span></span><br><span class="line">gridsphere:x:<span class="number">0</span>:<span class="number">0</span>:gridsphere:/gridsphere:/bin/bash</span><br></pre></td></tr></table></figure>
<p>index函数返回第二个字符串在第一个字符串中出现的首位置，length函数返回字符串的长度：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print index("gayyzxyx","yx")&#125;'</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;print length("gayyzxyx")&#125;'</span></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>match(s,t)测试s是否包含匹配t的字符串，t可以是一个正则表达式，若匹配成功就返回t的首位置，否则返回0,如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print match("gAyyzxyx",/A/)&#125;'</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>sub(r,s,t)只替换模式出现的第一个位置，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;str="multiprocessor programming";sub(/pro/,"PRO",str);printf("%s\n",str)&#125;'</span></span><br><span class="line"><span class="comment">#只有第一个pro被替换了</span></span><br><span class="line">multiPROcessor programming</span><br></pre></td></tr></table></figure>
<p>substr返回字符串的指定后缀，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;str="multiprocessor programming";print substr(str,6)&#125;'</span></span><br><span class="line">processor programming</span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;str="multiprocessor programming";print substr(str,6,9)&#125;'   #第6个位置开始，长度为9</span></span><br><span class="line">processor</span><br></pre></td></tr></table></figure>
<h3 id="8-_u5411AWK_u811A_u672C_u4F20_u9012_u53C2_u6570"><a href="#8-_u5411AWK_u811A_u672C_u4F20_u9012_u53C2_u6570" class="headerlink" title="8.向AWK脚本传递参数"></a>8.向AWK脚本传递参数</h3><p>awk脚本内的变量可以在命令行中进行赋值，实现向awk脚本传递参数，格式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk脚本 parameter=value 输入文件</span><br></pre></td></tr></table></figure>

参数可以是自定义的变量，也可以是系统变量。如下：

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># cat pass.awk </span></span><br><span class="line"><span class="comment">#判断记录的域数量是否等于MAX数量，如果不等于则输出包含NR和MAX两个变量的文本行</span></span><br><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">NF!=MAX</span><br><span class="line">&#123;<span class="built_in">print</span>(<span class="string">"the line "</span>NR<span class="string">" does  not have "</span>MAX<span class="string">" filds"</span>)&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># ./pass.awk MAX=3 FS="," stu</span></span><br><span class="line">Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line">the line <span class="number">1</span> does  not have <span class="number">3</span> filds</span><br><span class="line">Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line">the line <span class="number">2</span> does  not have <span class="number">3</span> filds</span><br><span class="line">Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line">the line <span class="number">3</span> does  not have <span class="number">3</span> filds</span><br><span class="line">Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br><span class="line">the line <span class="number">4</span> does  not have <span class="number">3</span> filds</span><br></pre></td></tr></table></figure>
<p>以下是输出stu的所有记录，每条记录加上行号(即NR变量值),然后重新定义OFS值，改变域的分隔符，即NR和$0之间用OFS定义的值分割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;FS=","&#125; &#123;print(NR,$0)&#125;' OFS="." stu</span></span><br><span class="line"><span class="number">1</span>.Li Hao,njue,<span class="number">025</span>-<span class="number">83481010</span>,<span class="number">85</span>,<span class="number">92</span>,<span class="number">78</span>,<span class="number">94</span>,<span class="number">88</span></span><br><span class="line"><span class="number">2</span>.Zhang Ju,nju,<span class="number">025</span>-<span class="number">83466534</span>,<span class="number">89</span>,<span class="number">90</span>,<span class="number">75</span>,<span class="number">90</span>,<span class="number">86</span></span><br><span class="line"><span class="number">3</span>.Wang B<span class="keyword">in</span>,seu,<span class="number">025</span>-<span class="number">83494883</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">80</span>,<span class="number">92</span>,<span class="number">84</span></span><br><span class="line"><span class="number">4</span>.Zhu L<span class="keyword">in</span>,njupt,<span class="number">025</span>-<span class="number">83680010</span>,<span class="number">98</span>,<span class="number">78</span>,<span class="number">81</span>,<span class="number">87</span>,<span class="number">76</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，命令行参数不能被BEGIN字段语句访问，换句话说，直到输入文件的第一行被读取时，命令行参数才生效，如下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk '</span></span><br><span class="line">&amp;gt; BEGIN &#123;<span class="built_in">print</span> n&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-_u6761_u4EF6_u8BED_u53E5_u548C_u5FAA_u73AF_u8BED_u53E5"><a href="#9-_u6761_u4EF6_u8BED_u53E5_u548C_u5FAA_u73AF_u8BED_u53E5" class="headerlink" title="9.条件语句和循环语句"></a>9.条件语句和循环语句</h3><p>awk的条件语句和循环语句的语法跟C语言的完全一样，有如下形式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (条件表达式)</span><br><span class="line">    动作<span class="number">1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	动作<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(x==y) <span class="built_in">print</span> x</span><br><span class="line"><span class="keyword">if</span>(x~/正则表达式/) <span class="built_in">print</span> x</span><br><span class="line"><span class="comment">#也可以while或者do&#123;&#125;while</span></span><br><span class="line"><span class="keyword">while</span>(条件表达式)</span><br><span class="line">	动作</span><br><span class="line"><span class="comment">#还可以for循环</span></span><br><span class="line"><span class="keyword">for</span>(初值，计数器，计数器变化)</span><br><span class="line">	动作</span><br></pre></td></tr></table></figure>
<h3 id="10-_u6570_u7EC4"><a href="#10-_u6570_u7EC4" class="headerlink" title="10.数组"></a>10.数组</h3><p>awk的数组的形式跟C语言的一样，但是awk数组无需定义数组类型和大小，可以直接赋值使用，基本格式为:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array[index]=value</span><br></pre></td></tr></table></figure>

1\.关联数组

关联数组的意思是数组的索引既可以是字符串也可以是数字。在大部分编程语言中数组的索引只能是数字，而awk的不是这样。安维卡的所有数组都是关联数组，这是awk数组和其他大部分编程语言的数组的区别。

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;data[10.15]="1200";CONVFMT="%d";printf("&amp;lt;%s&amp;gt;",ta[10.15])&#125;'   #字符串和数字是严格区分的</span></span><br><span class="line">&amp;lt;&amp;gt;</span><br></pre></td></tr></table></figure>
<p>awk定义了一种特别的for循环来访问关联数组，array是定义的数组名，variable是任意指定的变量，</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(variable <span class="keyword">in</span> array)</span><br><span class="line">	<span class="keyword">do</span> something with array[variable]</span><br></pre></td></tr></table></figure>
<p>关键字in也可以用在条件表达式中判断元素是否在数组中，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index <span class="keyword">in</span> array</span><br></pre></td></tr></table></figure>

如果array[index]存在，返回1，否则返回0,如下

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;data[10.15]="1200";if("10.15" in data) print "found element!"&#125;'</span></span><br><span class="line">found element!</span><br></pre></td></tr></table></figure>
<p>2.split函数</p>
<p>split函数的返回值是数组的大小，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print split("abc/def/xyz",str,"/")&#125;'    #将字符串abc/def/xyz分开，并存在str中</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;split("abc/def/xyz",str,"/");for(i in str) print str[i]&#125;'  #分别打印出来如下</span></span><br><span class="line">abc</span><br><span class="line">def</span><br><span class="line">xyz</span><br></pre></td></tr></table></figure>
<p>3.数组形式的系统变量</p>
<p>awk系统变量中有两个变量是以数组的形式提供的：<code>ARGV</code>和<code>ENVIRON</code>，ARGC是ARGV中数组中元素的个数，与C语言一样，从ARGV[0]开始到ARGV[ARGC-1]结束，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># cat &amp;gt; argv.awk</span></span><br><span class="line">BEGIN&#123;<span class="keyword">for</span>(x=<span class="number">0</span>;x&amp;lt;ARGC;x++)</span><br><span class="line"><span class="built_in">print</span> ARGV[x]</span><br><span class="line"><span class="built_in">print</span> ARGC</span><br><span class="line">&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># awk -f argv.awk xyz n=99 hello world    #xyz,n,hello world都是参数，可以看到awk[0]存的是awk,-f选项不在ARGV中，一般来说当不是执行脚本文件的时候，ARGC=2，如果没有输入文件，ARGC=1</span></span><br><span class="line">awk</span><br><span class="line">xyz</span><br><span class="line">n=<span class="number">99</span></span><br><span class="line">hello world</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>如果要查找文件中内容，比如我们输入学生名字查找出学生的电话号码，可以如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/awk -f               #findphone.awk的脚本</span></span><br><span class="line">BEGIN&#123;FS=<span class="string">","</span>;</span><br><span class="line">	<span class="keyword">if</span>(ARGC&amp;gt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="comment">#判断是否已经输入姓名</span></span><br><span class="line">		name=ARGV[<span class="number">1</span>];</span><br><span class="line">		delete ARGV[<span class="number">1</span>]&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(!name)&#123;<span class="built_in">print</span> <span class="string">"please enter a name"</span>;</span><br><span class="line">			getline name&amp;lt; <span class="string">"-"</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$1</span> ~name &#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># ./findphone.awk Zhu stu</span></span><br><span class="line">Zhu L<span class="keyword">in</span> <span class="number">025</span>-<span class="number">83680010</span></span><br><span class="line">root@core /home/awk<span class="comment"># ./findphone.awk stu</span></span><br><span class="line">please enter a name</span><br><span class="line">Zhu</span><br><span class="line">Zhu L<span class="keyword">in</span> <span class="number">025</span>-<span class="number">83680010</span></span><br></pre></td></tr></table></figure>
<p>ENVIRON变量存储了LINUX系统中的环境变量，如下可以打印出系统中ENVIRON数组中所有内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN &#123;for (i in ENVIRON) print i "=" ENVIRON[i]&#125;'</span></span><br><span class="line">SSH_CLIENT=<span class="number">192.168</span>.<span class="number">115.1</span> <span class="number">49633</span> <span class="number">22</span></span><br><span class="line">EDITOR=vim</span><br><span class="line">HOME=/root</span><br><span class="line">PAGER=less -X -R -F</span><br><span class="line">TERM=xterm</span><br><span class="line">LESSOPEN=| /usr/bin/lesspipe %s</span><br><span class="line">LANGUAGE=en_US.UTF-<span class="number">8</span></span><br><span class="line">LC_ALL=C</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">OLDPWD=/root</span><br><span class="line">USER=root</span><br><span class="line">_=/usr/bin/awk</span><br><span class="line">SHLVL=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ENVIRON索引的是环境变量名，因此也可以通过环境变量名得到其值：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@core /home/awk<span class="comment"># awk 'BEGIN&#123;print ENVIRON["HOME"]&#125;'</span></span><br><span class="line">/root</span><br></pre></td></tr></table></figure>
<p>最后看一个排序，对输入数组data:4,90,6.9,8,10,1,60,7.8,9.3进行排序，结合数组和逻辑控制，采用简单冒泡排序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/awk -f</span></span><br><span class="line">BEGIN &#123;FS=<span class="string">","</span>&#125; &#123;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>;i&amp;lt;NF;i++)&#123;</span><br><span class="line">		k=i</span><br><span class="line">	<span class="keyword">for</span>(j=i+<span class="number">1</span>;j&amp;lt;=NF;j++)</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&amp;lt;<span class="variable">$k</span>) k=j</span><br><span class="line">			temp=<span class="variable">$i</span>;<span class="variable">$i</span>=<span class="variable">$k</span>;<span class="variable">$k</span>=temp;&#125;</span><br><span class="line">	<span class="built_in">print</span> <span class="variable">$0</span></span><br><span class="line">&#125;</span><br><span class="line">root@core /home/awk<span class="comment"># ./sort.awk  data   #排序结果</span></span><br><span class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">6.9</span> <span class="number">7.8</span> <span class="number">8</span> <span class="number">9.3</span> <span class="number">10</span> <span class="number">60</span> <span class="number">90</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/awk/">awk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sed/">sed</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/shell/">shell</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-algorithm/2013-02-25-algorithms" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/02/25/algorithm/2013-02-25-algorithms/" class="article-date">
  	<time datetime="2013-02-24T16:00:00.000Z" itemprop="datePublished">2013-02-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/25/algorithm/2013-02-25-algorithms/">算法之路，任重道远</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>第一阶段：练经典常用算法，下面的每个算法给我打上十到二十遍，同时自己精简代码，<br>因为太常用，所以要练到写时不用想，10-15分钟内打完，甚至关掉显示器都可以把程序打<br>出来.</p>
<pre><code>1.最短路(Floyd、Dijstra,BellmanFord) 
2.最小生成树(先写个prim,kruscal要用并查集，不好写) 
3.大数（高精度）加减乘除 
4.二分查找. (代码可在五行以内) 
5.叉乘、判线段相交、然后写个凸包. 
6.BFS、DFS,同时熟练hash表(要熟，要灵活,代码要简) 
7.数学上的有：辗转相除（两行内），线段交点、多角形面积公式. 
8. 调用系统的qsort, 技巧很多，慢慢掌握. 
9. 任意进制间的转换
</code></pre><p>第二阶段：练习复杂一点，但也较常用的算法。 如： </p>
<pre><code>1. 二分图匹配（匈牙利），最小路径覆盖 
2. 网络流，最小费用流。 
3. 线段树. 
4. 并查集。 
5. 熟悉动态规划的各个典型：LCS、最长递增子串、三角剖分、记忆化dp 
6.博弈类算法。博弈树，二进制法等。 
7.最大团，最大独立集。 
8.判断点在多边形内。 
9. 差分约束系统. 
10. 双向广度搜索、A*算法，最小耗散优先.
</code></pre><h2 id="u76F8_u5173_u7684_u77E5_u8BC6"><a href="#u76F8_u5173_u7684_u77E5_u8BC6" class="headerlink" title="相关的知识"></a>相关的知识</h2><h3 id="u56FE_u8BBA"><a href="#u56FE_u8BBA" class="headerlink" title="图论"></a>图论</h3><p>路径问题 </p>
<pre><code>0/1边权最短路径 
BFS 
非负边权最短路径（Dijkstra） 
可以用Dijkstra解决问题的特征 
负边权最短路径 
Bellman-Ford 
Bellman-Ford的Yen-氏优化 
差分约束系统 
Floyd 
广义路径问题 
传递闭包 
极小极大距离 / 极大极小距离 
Euler Path / Tour 
圈套圈算法 
混合图的 Euler Path / Tour 
Hamilton Path / Tour 
特殊图的Hamilton Path / Tour 构造
</code></pre><p>生成树问题 </p>
<pre><code>最小生成树 
第k小生成树 
最优比率生成树 
0/1分数规划 
度限制生成树
</code></pre><p>连通性问题 </p>
<pre><code>强大的DFS算法 
无向图连通性 
    割点 
    割边 
    二连通分支 
    有向图连通性 
    强连通分支 
    2-SAT 
    最小点基
</code></pre><p>有向无环图 </p>
<pre><code>拓扑排序 
有向无环图与动态规划的关系
</code></pre><p>二分图匹配问题 </p>
<pre><code>一般图问题与二分图问题的转换思路 
最大匹配 
有向图的最小路径覆盖 
0 / 1矩阵的最小覆盖 
完备匹配 
最优匹配 
稳定婚姻
</code></pre><p>网络流问题 </p>
<pre><code>网络流模型的简单特征和与线性规划的关系 
最大流最小割定理 
最大流问题 
有上下界的最大流问题 
循环流 
最小费用最大流 / 最大费用最大流
</code></pre><p>弦图的性质和判定</p>
<p>组合数学</p>
<pre><code>解决组合数学问题时常用的思想 
    逼近 
    递推 / 动态规划 
概率问题 
    Polya定理
</code></pre><p>计算几何 / 解析几何</p>
<pre><code>计算几何的核心：叉积 / 面积 
解析几何的主力：复数

基本形 
    点 
    直线，线段 
    多边形

凸多边形 / 凸包 
凸包算法的引进，卷包裹法

Graham扫描法 
水平序的引进，共线凸包的补丁

完美凸包算法

相关判定 
    两直线相交 
    两线段相交 
    点在任意多边形内的判定 
    点在凸多边形内的判定

经典问题 
    最小外接圆 
        近似O(n)的最小外接圆算法 
    点集直径 
        旋转卡壳，对踵点 
多边形的三角剖分
</code></pre><p>数学 / 数论</p>
<pre><code>最大公约数 
    Euclid算法 
    扩展的Euclid算法 
            同余方程 / 二元一次不定方程 
            同余方程组

线性方程组 
    高斯消元法 
        解mod 2域上的线性方程组 
    整系数方程组的精确解法

矩阵 
    行列式的计算 
        利用矩阵乘法快速计算递推关系

分数 
    分数树 
    连分数逼近

数论计算 
    求N的约数个数 
    求phi(N) 
    求约数和 
    快速数论变换 
    ……

素数问题 
    概率判素算法 
    概率因子分解
</code></pre><p>数据结构</p>
<pre><code>组织结构 
    二叉堆 
    左偏树 
    二项树 
    胜者树 
    跳跃表 
    样式图标 
    斜堆 
    reap

统计结构 
    树状数组 
    虚二叉树 
    线段树 
        矩形面积并 
        圆形面积并

关系结构 
    Hash表 
    并查集 
        路径压缩思想的应用

STL中的数据结构 
    vector 
    deque 
    set / map
</code></pre><p>动态规划 / 记忆化搜索</p>
<pre><code>动态规划和记忆化搜索在思考方式上的区别

最长子序列系列问题 
    最长不下降子序列 
    最长公共子序列 
    最长公共不下降子序列

一类NP问题的动态规划解法

树型动态规划

背包问题

动态规划的优化 
    四边形不等式 
    函数的凸凹性 
    状态设计 
    规划方向
</code></pre><p>线性规划</p>
<p>常用思想</p>
<pre><code>二分          最小表示法
</code></pre><p>串</p>
<pre><code>KMP                              Trie结构 
后缀树/后缀数组            LCA/RMQ 
有限状态自动机理论
</code></pre><p>排序 </p>
<pre><code>选择/冒泡        快速排序        堆排序            归并排序 
基数排序        拓扑排序        排序网络
</code></pre><p>中级: </p>
<pre><code>一.基本算法: 
    (1)C++的标准模版库的应用. (poj3096,poj3007) 
    (2)较为复杂的模拟题的训练(poj3393,poj1472,poj3371,poj1027,poj2706) 
二.图算法: 
    (1)差分约束系统的建立和求解. (poj1201,poj2983) 
    (2)最小费用最大流(poj2516,poj2516,poj2195) 
    (3)双连通分量(poj2942) 
    (4)强连通分支及其缩点.(poj2186) 
    (5)图的割边和割点(poj3352) 
    (6)最小割模型、网络流规约(poj3308, ) 
三.数据结构. 
    (1)线段树. (poj2528,poj2828,poj2777,poj2886,poj2750) 
    (2)静态二叉检索树. (poj2482,poj2352) 
    (3)树状树组(poj1195,poj3321) 
    (4)RMQ. (poj3264,poj3368) 
    (5)并查集的高级应用. (poj1703,2492) 
    (6)KMP算法. (poj1961,poj2406) 
四.搜索 
    (1)最优化剪枝和可行性剪枝 
    (2)搜索的技巧和优化 (poj3411,poj1724) 
    (3)记忆化搜索(poj3373,poj1691) 

五.动态规划 
    (1)较为复杂的动态规划(如动态规划解特别的施行商问题等) 
        (poj1191,poj1054,poj3280,poj2029,poj2948,poj1925,poj3034) 
    (2)记录状态的动态规划. (POJ3254,poj2411,poj1185) 
    (3)树型动态规划(poj2057,poj1947,poj2486,poj3140) 
六.数学 
    (1)组合数学: 
        1.容斥原理. 
        2.抽屉原理. 
        3.置换群与Polya定理(poj1286,poj2409,poj3270,poj1026). 
        4.递推关系和母函数. 

    (2)数学. 
        1.高斯消元法(poj2947,poj1487, poj2065,poj1166,poj1222) 
        2.概率问题. (poj3071,poj3440) 
        3.GCD、扩展的欧几里德(中国剩余定理) (poj3101) 
    (3)计算方法. 
        1.0/1分数规划. (poj2976) 
        2.三分法求解单峰(单谷)的极值. 
        3.矩阵法(poj3150,poj3422,poj3070) 
        4.迭代逼近(poj3301) 
    (4)随机化算法(poj3318,poj2454) 
    (5)杂题. 
        (poj1870,poj3296,poj3286,poj1095) 
七.计算几何学. 
        (1)坐标离散化. 
        (2)扫描线算法(例如求矩形的面积和周长并,常和线段树或堆一起使用). 
            (poj1765,poj1177,poj1151,poj3277,poj2280,poj3004) 
        (3)多边形的内核(半平面交)(poj3130,poj3335) 
        (4)几何工具的综合应用.(poj1819,poj1066,poj2043,poj3227,poj2165,poj3429)
</code></pre><p>高级: </p>
<pre><code>一.基本算法要求:  
      (1)代码快速写成,精简但不失风格  (poj2525,poj1684,poj1421,poj1048,poj2050,poj3306) 
      (2)保证正确性和高效性. poj3434 
二.图算法: 
      (1)度限制最小生成树和第K最短路. (poj1639) 
      (2)最短路,最小生成树,二分图,最大流问题的相关理论(主要是模型建立和求解) (poj3155, poj2112,poj1966,poj3281,poj1087,poj2289,poj3216,poj2446 
      (3)最优比率生成树. (poj2728) 
      (4)最小树形图(poj3164) 
      (5)次小生成树. 
      (6)无向图、有向图的最小环    
三.数据结构.  
      (1)trie图的建立和应用. (poj2778) 
      (2)LCA和RMQ问题(LCA(最近公共祖先问题) 有离线算法(并查集+dfs) 和 在线算法 (RMQ+dfs)).(poj1330) 
      (3)双端队列和它的应用(维护一个单调的队列,常常在动态规划中起到优化状态转移的 目的). (poj2823) 
      (4)左偏树(可合并堆).  
      (5)后缀树(非常有用的数据结构,也是赛区考题的热点).  (poj3415,poj3294) 
四.搜索  
      (1)较麻烦的搜索题目训练(poj1069,poj3322,poj1475,poj1924,poj2049,poj3426) 
      (2)广搜的状态优化:利用M进制数存储状态、转化为串用hash表判重、按位压缩存储状态、双向广搜、A*算法. (poj1768,poj1184,poj1872,poj1324,poj2046,poj1482) 
      (3)深搜的优化:尽量用位运算、一定要加剪枝、函数参数尽可能少、层数不易过大、可以考虑双向搜索或者是轮换搜索、IDA*算法. (  poj3131,poj2870,poj2286) 
五.动态规划  
      (1)需要用数据结构优化的动态规划.  (poj2754,poj3378,poj3017) 
      (2)四边形不等式理论. 
      (3)较难的状态DP(poj3133) 
六.数学  
      (1)组合数学. 
        1.MoBius反演(poj2888,poj2154) 
        2.偏序关系理论. 
      (2)博奕论. 
        1.极大极小过程(poj3317,poj1085) 
        2.Nim问题. 
七.计算几何学.  
      (1)半平面求交(poj3384,poj2540) 
      (2)可视图的建立(poj2966) 
      (3)点集最小圆覆盖. 
      (4)对踵点(poj2079) 
八.综合题. (poj3109,poj1478,poj1462,poj2729,poj2048,poj3336,poj3315,poj2148,poj1263)
</code></pre><p>初期: </p>
<pre><code>一.基本算法: 
    (1)枚举. (poj1753,poj2965) (2)贪心(poj1328,poj2109,poj2586) 
    (3)递归和分治法.                  (4)递推. 
    (5)构造法.(poj3295)            (6)模拟法.(poj1068,poj2632,poj1573,poj2993,poj2996) 
二.图算法: 
    (1)图的深度优先遍历和广度优先遍历. 
    (2)最短路径算法(dijkstra,bellman-ford,floyd,heap+dijkstra) 
        (poj1860,poj3259,poj1062,poj2253,poj1125,poj2240) 
    (3)最小生成树算法(prim,kruskal) 
        (poj1789,poj2485,poj1258,poj3026) 
    (4)拓扑排序 (poj1094) 
    (5)二分图的最大匹配 (匈牙利算法) (poj3041,poj3020) 
    (6)最大流的增广路算法(KM算法). (poj1459,poj3436) 
三.数据结构. 
    (1)串 (poj1035,poj3080,poj1936) 
    (2)排序(快排、归并排(与逆序数有关)、堆排) (poj2388,poj2299) 
    (3)简单并查集的应用. 
    (4)哈希表和二分查找等高效查找法(数的Hash,串的Hash)    
        (poj3349,poj3274,POJ2151,poj1840,poj2002,poj2503) 
    (5)哈夫曼树(poj3253) 
    (6)堆 
    (7)trie树(静态建树、动态建树) (poj2513) 
四.简单搜索 
    (1)深度优先搜索 (poj2488,poj3083,poj3009,poj1321,poj2251) 
    (2)广度优先搜索(poj3278,poj1426,poj3126,poj3087.poj3414) 
    (3)简单搜索技巧和剪枝(poj2531,poj1416,poj2676,1129) 
五.动态规划 
    (1)背包问题. (poj1837,poj1276) 
    (2)型如下表的简单DP(可参考lrj的书 page149): 
      1.E[j]=opt (poj3267,poj1836,poj1260,poj2533) 
      2.E[i,j]=opt (最长公共子序列)    
        (poj3176,poj1080,poj1159) 
      3.C[i,j]=w[i,j]+opt.(最优二分检索树问题) 
六.数学 
    (1)组合数学: 
        1.加法原理和乘法原理. 
        2.排列组合. 
        3.递推关系. 
          (POJ3252,poj1850,poj1019,poj1942) 
    (2)数论. 
        1.素数与整除问题 
        2.进制位. 
        3.同余模运算. 
          (poj2635, poj3292,poj1845,poj2115) 
    (3)计算方法. 
        1.二分法求解单调函数相关知识.(poj3273,poj3258,poj1905,poj3122) 
七.计算几何学. 
    (1)几何公式. 
    (2)叉积和点积的运用(如线段相交的判定,点到线段的距离等). (poj2031,poj1039) 
    (3)多边型的简单算法(求面积)和相关判定(点在多边型内,多边型是否相交) 
        (poj1408,poj1584) 
    (4)凸包. (poj2187,poj1113)
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/algorithm/">algorithm</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Kenshin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>